# ✅ 部署前检查清单

在执行部署之前，请确保完成以下所有检查项：

## 📋 必须完成的配置

### 1. ⚠️ QQ邮箱授权码配置（必须）

**状态**: [ ] 未完成 / [x] 已完成

**位置**: `backend/.env.production`

**需要修改的内容**:
```env
SMTP_PASSWORD=你的QQ邮箱授权码  # ⚠️ 必须修改这里
```

**如何获取QQ邮箱授权码**:

1. 登录 QQ邮箱: https://mail.qq.com
2. 点击 **设置** → **账户**
3. 找到 **POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务**
4. 开启 **IMAP/SMTP服务**
5. 点击 **生成授权码**
6. 发送短信验证
7. 复制生成的16位授权码
8. 粘贴到 `backend/.env.production` 的 `SMTP_PASSWORD` 字段

**验证方法**:
```bash
# 检查是否已配置
cat backend/.env.production | grep SMTP_PASSWORD
```

---

### 2. 🌐 域名DNS解析配置（必须）

**状态**: [ ] 未完成 / [x] 已完成

**需要在腾讯云DNS解析中添加以下记录**:

| 主机记录 | 记录类型 | 记录值 | TTL | 状态 |
|---------|---------|--------|-----|------|
| @ | A | 43.142.188.252 | 600 | [ ] |
| laimiu | A | 43.142.188.252 | 600 | [ ] |
| api | A | 43.142.188.252 | 600 | [ ] |

**验证方法**:
```powershell
# 在本地PowerShell执行
ping sdhaohan.cn
ping laimiu.sdhaohan.cn
ping api.sdhaohan.cn
```

如果能ping通，说明DNS解析已生效。

---

### 3. 🔒 服务器安全组配置（必须）

**状态**: [ ] 未完成 / [x] 已完成

**需要在腾讯云控制台开放以下端口**:

| 端口 | 协议 | 说明 | 状态 |
|-----|------|------|------|
| 22 | TCP | SSH登录 | [ ] |
| 80 | TCP | HTTP（SSL证书验证） | [ ] |
| 443 | TCP | HTTPS | [ ] |

**验证方法**:
```powershell
# 测试SSH端口
Test-NetConnection -ComputerName 43.142.188.252 -Port 22

# 测试HTTP端口
Test-NetConnection -ComputerName 43.142.188.252 -Port 80

# 测试HTTPS端口
Test-NetConnection -ComputerName 43.142.188.252 -Port 443
```

---

## 🔍 可选检查项

### 4. 📦 本地环境检查

**状态**: [ ] 未完成 / [x] 已完成

**检查项**:
- [ ] 已安装 PowerShell 5.0 或更高版本
- [ ] 已安装 SSH 客户端（Windows 10/11自带）
- [ ] 网络连接正常

**验证方法**:
```powershell
# 检查PowerShell版本
$PSVersionTable.PSVersion

# 检查SSH
ssh -V

# 测试网络
Test-Connection -ComputerName 43.142.188.252 -Count 2
```

---

### 5. 🔑 SSH密钥验证

**状态**: [ ] 未完成 / [x] 已完成

**SSH密钥内容**:
```
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcOr08lnUObi+djGnoalQpZ+6MgRuhH9BXB2k4g/sAOYeqs/y4xzcmDsdqF3Www8f0OwEmaII39kLTh0iucu4GS0G8aSKqD9gw4cQ9msH2cWk9EKH9jQyiASUOh/uZy7mhg145WAP+fUQ9HMU4D1oavdUnGCr5xyVyc9cgFjKcQizXTVPqR0KqdF7r8D2q9vV+25CCwWtwOtY8gAGLafsPT/BTs8Av9PbCIU7iCuad6kq/N0/n/g5q5+eohumpIaD/6OaT4NhWo4+ClC4iKEVqvykTiV6XuJUL+8KahJD/0+tTfw2UhQzIwEE7JVU+x776Fb8YKvapjZOFzZWxIaTf skey-o3j71l2x
```

**验证方法**:
```powershell
# 创建临时密钥文件
$sshKey = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDcOr08lnUObi+djGnoalQpZ+6MgRuhH9BXB2k4g/sAOYeqs/y4xzcmDsdqF3Www8f0OwEmaII39kLTh0iucu4GS0G8aSKqD9gw4cQ9msH2cWk9EKH9jQyiASUOh/uZy7mhg145WAP+fUQ9HMU4D1oavdUnGCr5xyVyc9cgFjKcQizXTVPqR0KqdF7r8D2q9vV+25CCwWtwOtY8gAGLafsPT/BTs8Av9PbCIU7iCuad6kq/N0/n/g5q5+eohumpIaD/6OaT4NhWo4+ClC4iKEVqvykTiV6XuJUL+8KahJD/0+tTfw2UhQzIwEE7JVU+x776Fb8YKvapjZOFzZWxIaTf skey-o3j71l2x"
$sshKey | Out-File -FilePath "test-key.pem" -Encoding ASCII -NoNewline

# 测试连接
ssh -i test-key.pem -o StrictHostKeyChecking=no root@43.142.188.252 "echo 'SSH连接成功'"

# 清理
Remove-Item test-key.pem
```

---

### 6. 📁 项目文件完整性检查

**状态**: [ ] 未完成 / [x] 已完成

**必需的文件和目录**:
- [ ] `backend/` - 后端代码
- [ ] `frontend/` - 前端代码
- [ ] `admin-portal/` - 管理门户代码
- [ ] `docker-compose.yml` - Docker编排配置
- [ ] `deploy.sh` - 部署脚本
- [ ] `backend/.env.production` - 生产环境配置
- [ ] `nginx/` - Nginx配置

**验证方法**:
```powershell
# 检查关键文件
Test-Path backend
Test-Path frontend
Test-Path admin-portal
Test-Path docker-compose.yml
Test-Path deploy.sh
Test-Path backend/.env.production
Test-Path nginx
```

---

## 🚀 准备部署

### 所有检查项都完成了吗？

- [ ] 1. QQ邮箱授权码已配置
- [ ] 2. 域名DNS解析已配置
- [ ] 3. 服务器安全组已配置
- [ ] 4. 本地环境检查通过
- [ ] 5. SSH密钥验证通过
- [ ] 6. 项目文件完整性检查通过

### 如果所有检查项都已完成，可以开始部署了！

**执行部署命令**:
```powershell
# 方式一：使用快速部署脚本（推荐）
.\快速部署.ps1

# 方式二：使用完整部署脚本
.\deploy-to-server.ps1
```

---

## ⚠️ 重要提示

### 部署时间
- 首次部署大约需要 **10-15分钟**
- 主要时间花在：
  - 上传代码（2-3分钟）
  - 安装Docker（如果未安装，3-5分钟）
  - 构建Docker镜像（5-8分钟）
  - 启动服务（1-2分钟）

### 网络要求
- 确保本地网络稳定
- 服务器需要能访问外网（下载Docker镜像）
- 如果网络较慢，可能需要更长时间

### 常见问题
1. **SSH连接超时**: 检查服务器IP和安全组配置
2. **上传失败**: 检查网络连接，可以重试
3. **Docker构建慢**: 正常现象，首次构建需要下载很多依赖
4. **端口被占用**: 检查服务器上是否有其他服务占用80/443端口

---

## 📞 需要帮助？

如果遇到问题：

1. **查看部署日志**: 脚本会显示详细的执行过程
2. **检查服务器日志**: 
   ```bash
   ssh -i server-key.pem root@43.142.188.252 "cd /root/sdweld && docker-compose logs"
   ```
3. **查看本文档**: 仔细阅读每个检查项
4. **重新执行**: 大部分问题可以通过重新执行部署脚本解决

---

## ✅ 部署成功标志

当看到以下输出时，说明部署成功：

```
========================================
部署成功！
========================================

访问地址：
  用户门户: https://sdhaohan.cn
  管理门户: https://laimiu.sdhaohan.cn
  后端API:  https://api.sdhaohan.cn
  API文档:  https://api.sdhaohan.cn/api/v1/docs
```

访问上述地址，如果能正常打开页面，恭喜你，部署成功！🎉


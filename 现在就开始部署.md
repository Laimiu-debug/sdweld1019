# 🚀 现在就开始部署！

## ✅ 准备工作已完成

- ✅ QQ邮箱授权码已配置：`rsheuhkrdlqpecij`
- ✅ 服务器信息已确认：43.142.188.252
- ✅ SSH密钥已准备好
- ✅ 部署脚本已创建

---

## 🎯 开始部署（只需3步）

### 步骤1：推送代码到Git仓库

如果你还没有将代码推送到Git，执行以下命令：

```powershell
# 初始化Git仓库（如果还没有）
git init

# 添加所有文件
git add .

# 提交
git commit -m "Initial commit - Ready for deployment"

# 添加远程仓库（替换为你的仓库地址）
# GitHub示例：
git remote add origin https://github.com/你的用户名/sdweld-system.git

# 或者Gitee（国内速度更快）：
# git remote add origin https://gitee.com/你的用户名/sdweld-system.git

# 推送到远程仓库
git branch -M main
git push -u origin main
```

**如果已经推送过，跳过此步骤。**

---

### 步骤2：运行部署脚本

在项目根目录，打开PowerShell，执行：

```powershell
.\首次部署到服务器.ps1
```

**就这么简单！** 🎉

---

### 步骤3：等待部署完成

脚本会自动完成以下操作：

1. ✅ 检查Git仓库
2. ✅ 推送最新代码
3. ✅ 连接服务器
4. ✅ 创建ubuntu用户
5. ✅ 安装Docker和docker-compose
6. ✅ 克隆代码到 `/home/ubuntu/sdweld`
7. ✅ 上传环境配置文件（包含你的邮箱授权码）
8. ✅ 构建Docker镜像
9. ✅ 启动所有服务
10. ✅ 初始化数据库

**预计时间**: 15-20分钟

---

## 🌐 部署成功后访问

- **用户门户**: https://sdhaohan.cn
- **管理门户**: https://laimiu.sdhaohan.cn
- **后端API**: https://api.sdhaohan.cn
- **API文档**: https://api.sdhaohan.cn/api/v1/docs

---

## ❓ 如果遇到问题

### 问题1：提示"无法运行脚本"

**错误信息**:
```
无法加载文件 *.ps1，因为在此系统上禁止运行脚本
```

**解决方法**:
```powershell
# 以管理员身份运行PowerShell，执行：
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

---

### 问题2：没有Git仓库

**错误信息**:
```
未检测到Git远程仓库
```

**解决方法**:

1. **创建GitHub仓库**（推荐）
   - 访问: https://github.com/new
   - 创建新仓库（可以是私有的）
   - 复制仓库地址

2. **或创建Gitee仓库**（国内速度更快）
   - 访问: https://gitee.com/projects/new
   - 创建新仓库
   - 复制仓库地址

3. **添加远程仓库并推送**
   ```powershell
   git remote add origin <你的仓库地址>
   git push -u origin main
   ```

---

### 问题3：SSH连接失败

**可能原因**:
- 服务器安全组未开放22端口
- 网络连接问题

**解决方法**:
1. 登录腾讯云控制台
2. 检查安全组配置
3. 确保开放了22、80、443端口

---

## 🔄 后续更新代码

当你修改了代码后，使用这个脚本更新：

```powershell
.\更新服务器代码.ps1
```

这个脚本会：
1. 推送本地代码到Git
2. 在服务器上拉取最新代码
3. 询问是否重新部署

---

## 📋 部署信息汇总

### 服务器信息
- **IP地址**: 43.142.188.252
- **操作系统**: Ubuntu 22.04
- **部署用户**: ubuntu（普通用户）
- **部署目录**: /home/ubuntu/sdweld

### 邮箱配置
- **SMTP服务器**: smtp.qq.com
- **SMTP端口**: 587
- **邮箱账号**: 2564786659@qq.com
- **授权码**: rsheuhkrdlqpecij ✅ 已配置

### 域名配置
- **用户门户**: sdhaohan.cn
- **管理门户**: laimiu.sdhaohan.cn
- **后端API**: api.sdhaohan.cn

---

## 🛠️ 常用命令（部署后）

### 查看服务状态
```powershell
ssh -i server-key.pem root@43.142.188.252 "su - ubuntu -c 'cd /home/ubuntu/sdweld && docker-compose ps'"
```

### 查看日志
```powershell
# 查看所有日志
ssh -i server-key.pem root@43.142.188.252 "su - ubuntu -c 'cd /home/ubuntu/sdweld && docker-compose logs -f'"

# 查看后端日志
ssh -i server-key.pem root@43.142.188.252 "su - ubuntu -c 'cd /home/ubuntu/sdweld && docker-compose logs -f backend'"
```

### 重启服务
```powershell
ssh -i server-key.pem root@43.142.188.252 "su - ubuntu -c 'cd /home/ubuntu/sdweld && docker-compose restart'"
```

---

## 💡 重要提示

1. **安全建议**
   - ⚠️ 不要将 `backend/.env.production` 提交到Git
   - ⚠️ 妥善保管SSH密钥文件 `server-key.pem`
   - ⚠️ 定期备份数据库数据

2. **部署位置**
   - ✅ 项目部署在 `/home/ubuntu/sdweld`（普通用户目录）
   - ✅ 比部署在 `/root` 更安全、更规范

3. **后续维护**
   - ✅ 使用 `更新服务器代码.ps1` 更新代码
   - ✅ 定期查看服务器日志
   - ✅ 定期备份数据库

---

## 🎉 准备好了！

所有准备工作已完成，现在运行：

```powershell
.\首次部署到服务器.ps1
```

**祝部署顺利！** 🚀

---

## 📞 需要帮助？

- **快速参考**: `快速开始.txt`
- **详细文档**: `README-部署说明.md`
- **手动部署**: `Git部署到普通目录.md`
- **文件说明**: `部署文件说明.md`


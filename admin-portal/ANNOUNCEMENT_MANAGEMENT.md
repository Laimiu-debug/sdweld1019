# 公告管理功能说明

## 📢 功能概述

管理员门户的公告管理功能允许管理员创建、编辑、发布和管理系统公告。这些公告会显示在用户端的通知中心。

## 🎯 功能特性

### 1. 公告列表
- ✅ 分页显示所有公告
- ✅ 筛选功能（发布状态、公告类型）
- ✅ 显示公告详细信息（标题、内容、类型、优先级、目标受众等）
- ✅ 实时查看浏览量统计

### 2. 创建公告
- ✅ 设置公告标题和内容
- ✅ 选择公告类型（信息、警告、错误、成功、维护）
- ✅ 设置优先级（低、普通、重要、紧急）
- ✅ 选择目标受众（所有用户、个人用户、企业用户）
- ✅ 设置发布时间和过期时间
- ✅ 置顶显示选项

### 3. 编辑公告
- ✅ 修改公告的所有属性
- ✅ 保存为草稿或直接发布

### 4. 发布管理
- ✅ 一键发布公告
- ✅ 取消发布已发布的公告
- ✅ 草稿状态管理

### 5. 删除公告
- ✅ 删除不需要的公告
- ✅ 删除前确认提示

### 6. 查看详情
- ✅ 查看公告完整内容
- ✅ 查看公告所有元数据

## 📋 公告属性说明

### 公告类型 (announcement_type)
| 类型 | 图标 | 颜色 | 用途 |
|------|------|------|------|
| info | ℹ️ | 蓝色 | 一般信息通知 |
| warning | ⚠️ | 橙色 | 警告信息 |
| error | ❌ | 红色 | 错误或严重问题 |
| success | ✅ | 绿色 | 成功或积极消息 |
| maintenance | 🔧 | 紫色 | 系统维护通知 |

### 优先级 (priority)
| 优先级 | 标签颜色 | 说明 |
|--------|----------|------|
| urgent | 红色 | 紧急通知，需要立即关注 |
| high | 橙色 | 重要通知 |
| normal | 默认 | 普通通知 |
| low | 默认 | 低优先级通知 |

### 目标受众 (target_audience)
| 受众 | 说明 |
|------|------|
| all | 所有用户（个人+企业） |
| user | 仅个人用户 |
| enterprise | 仅企业用户 |

### 发布状态
| 状态 | 说明 |
|------|------|
| 草稿 | 未发布，用户看不到 |
| 已发布 | 已发布，用户可以看到 |

### 其他属性
- **置顶 (is_pinned)**: 置顶的公告会在通知列表中优先显示
- **发布时间 (publish_at)**: 公告开始显示的时间（可选）
- **过期时间 (expire_at)**: 公告停止显示的时间（可选）
- **浏览量 (view_count)**: 公告被查看的次数

## 🚀 使用流程

### 创建并发布公告

1. **进入公告管理页面**
   - 在管理员门户左侧菜单点击"公告管理"

2. **创建新公告**
   - 点击"创建公告"按钮
   - 填写公告标题（必填）
   - 填写公告内容（必填，最多5000字）
   - 选择公告类型（必选）
   - 选择优先级（必选）
   - 选择目标受众（必选）
   - 可选：设置发布时间和过期时间
   - 可选：勾选"置顶显示"
   - 点击"提交"

3. **发布公告**
   - 在公告列表中找到刚创建的公告（状态为"草稿"）
   - 点击"发布"按钮（绿色对勾图标）
   - 公告状态变为"已发布"
   - 用户端通知中心会立即显示该公告

### 编辑公告

1. 在公告列表中找到要编辑的公告
2. 点击"编辑"按钮（铅笔图标）
3. 修改公告内容
4. 点击"提交"保存修改

### 取消发布公告

1. 在公告列表中找到已发布的公告
2. 点击"取消发布"按钮（红色叉号图标）
3. 公告状态变为"草稿"
4. 用户端通知中心不再显示该公告

### 删除公告

1. 在公告列表中找到要删除的公告
2. 点击"删除"按钮（垃圾桶图标）
3. 确认删除操作
4. 公告被永久删除

## 💡 最佳实践

### 1. 公告标题
- ✅ 简洁明了，不超过50字
- ✅ 突出重点信息
- ❌ 避免使用过于技术性的术语

### 2. 公告内容
- ✅ 清晰描述通知内容
- ✅ 包含必要的时间、地点、影响范围等信息
- ✅ 提供解决方案或后续步骤
- ❌ 避免冗长的段落

### 3. 类型和优先级选择
- **系统维护** → maintenance + high/urgent
- **新功能上线** → success + normal
- **重要更新** → info + high
- **安全警告** → warning/error + urgent
- **一般通知** → info + normal

### 4. 目标受众
- 根据公告内容选择合适的受众
- 避免向不相关的用户发送通知

### 5. 时间设置
- **立即发布**: 不设置发布时间
- **定时发布**: 设置未来的发布时间
- **限时公告**: 同时设置发布时间和过期时间
- **永久公告**: 只设置发布时间，不设置过期时间

### 6. 置顶使用
- 仅对最重要的公告使用置顶
- 避免同时置顶过多公告
- 及时取消不再重要的置顶公告

## 🔗 用户端显示

用户在以下位置可以看到公告：

1. **通知中心**
   - 点击右上角铃铛图标
   - 查看所有未读/已读公告
   - 点击公告查看详情

2. **通知详情弹窗**
   - 显示完整的公告内容
   - 显示公告类型、优先级等信息
   - 自动标记为已读

## 📊 数据统计

- **浏览量**: 每个公告的查看次数
- **未读数量**: 用户未读公告的数量
- **发布状态**: 草稿/已发布公告的数量

## 🔧 技术实现

### 前端
- **页面**: `admin-portal/src/pages/AnnouncementManagement.tsx`
- **服务**: `admin-portal/src/services/announcements.ts`
- **类型**: `admin-portal/src/types/index.ts`

### 后端
- **API**: `backend/app/api/v1/endpoints/system_admin.py`
- **模型**: `backend/app/models/system_announcement.py`
- **用户端API**: `backend/app/api/v1/endpoints/notifications.py`

### API端点

#### 管理员端
- `GET /api/v1/admin/announcements` - 获取公告列表
- `GET /api/v1/admin/announcements/{id}` - 获取公告详情
- `POST /api/v1/admin/announcements` - 创建公告
- `PUT /api/v1/admin/announcements/{id}` - 更新公告
- `DELETE /api/v1/admin/announcements/{id}` - 删除公告
- `POST /api/v1/admin/announcements/{id}/publish` - 发布公告
- `POST /api/v1/admin/announcements/{id}/unpublish` - 取消发布公告

#### 用户端
- `GET /api/v1/notifications/` - 获取通知列表
- `GET /api/v1/notifications/unread-count` - 获取未读数量
- `POST /api/v1/notifications/{id}/mark-read` - 标记已读
- `POST /api/v1/notifications/mark-all-read` - 全部标记已读
- `DELETE /api/v1/notifications/{id}` - 删除通知

## 🎉 总结

公告管理功能为管理员提供了一个强大而灵活的工具来与用户沟通。通过合理使用公告类型、优先级和目标受众设置，可以确保重要信息及时传达给正确的用户群体。


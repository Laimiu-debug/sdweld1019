# WPS 模板 CRUD 功能快速指南

## 🎯 功能总览

| 功能 | 按钮 | 图标 | 适用范围 |
|------|------|------|---------|
| 查看 | 眼睛 | 👁️ | 所有模板 |
| 编辑 | 编辑 | ✏️ | 非系统模板 |
| 复制 | 复制 | 📋 | 非系统模板 |
| 删除 | 删除 | 🗑️ | 非系统模板 |

## 📝 使用说明

### 1️⃣ 创建模板
```
页面顶部 → "使用模块创建模板" 按钮
  ↓
填写模板信息（名称、工艺、标准等）
  ↓
拖拽模块到画布
  ↓
点击"保存"
```

### 2️⃣ 编辑模板
```
表格中找到模板 → 点击"编辑"按钮
  ↓
修改模板信息和模块
  ↓
点击"保存"
```

### 3️⃣ 复制模板
```
表格中找到模板 → 点击"复制"按钮
  ↓
模板名称自动添加"(副本)"
  ↓
可修改模板信息
  ↓
点击"保存"创建新模板
```

### 4️⃣ 删除模板
```
表格中找到模板 → 点击"删除"按钮
  ↓
确认删除对话框
  ↓
点击"确定"删除
```

### 5️⃣ 查看模板详情
```
表格中找到模板 → 点击"查看"按钮
  ↓
打开模态框显示模板详情
```

## 🔧 技术实现

### 前端修改

#### TemplateBuilder.tsx
- ✅ 支持编辑模式（`editingTemplate` prop）
- ✅ 自动初始化表单和模块
- ✅ 动态显示标题（创建/编辑）
- ✅ 保存时传递 `templateId`

#### TemplateManagement.tsx
- ✅ 添加 `editingTemplate` 状态
- ✅ 实现 `handleEdit` 函数
- ✅ 实现 `handleCopy` 函数
- ✅ 更新表格操作列
- ✅ 修改 `handleSaveTemplate` 支持创建/更新

### 后端支持

✅ 已有完整的 CRUD 端点：
- `POST /wps-templates/` - 创建
- `GET /wps-templates/{id}` - 获取详情
- `PUT /wps-templates/{id}` - 更新
- `DELETE /wps-templates/{id}` - 删除

## 🎨 UI 变化

### 表格操作列
```
原来：查看 | 编辑(禁用) | 删除
现在：查看 | 编辑 | 复制 | 删除
```

### 模态框标题
```
创建模式：创建模板 - 模块化拖拽
编辑模式：编辑模板 - {模板名称}
```

## 🔐 权限控制

| 操作 | 系统模板 | 用户模板 | 企业模板 |
|------|---------|---------|---------|
| 查看 | ✅ | ✅ | ✅ |
| 编辑 | ❌ | ✅ | ✅ |
| 复制 | ❌ | ✅ | ✅ |
| 删除 | ❌ | ✅ | ✅ |

## 🌍 工作区支持

- **个人工作区**：创建/编辑的模板为个人模板
- **企业工作区**：创建/编辑的模板为企业模板
- **自动检测**：系统自动根据当前工作区设置 `workspace_type`

## ✨ 特色功能

### 复制模板
- 快速创建相似模板
- 自动添加"(副本)"后缀
- 可修改后保存为新模板
- 不影响原模板

### 编辑模板
- 保留原模板 ID
- 更新所有字段
- 保持工作区类型
- 自动刷新列表

## 🧪 测试清单

- [ ] 创建新模板
- [ ] 编辑已创建的模板
- [ ] 复制模板
- [ ] 删除模板
- [ ] 在个人工作区创建模板
- [ ] 在企业工作区创建模板
- [ ] 验证系统模板不可编辑
- [ ] 验证系统模板不可删除
- [ ] 验证删除后列表自动刷新
- [ ] 验证编辑后列表自动刷新

## 📞 常见问题

**Q: 系统模板可以编辑吗？**
A: 不可以，系统模板仅可查看。

**Q: 复制模板会复制使用次数吗？**
A: 不会，复制的模板使用次数为 0。

**Q: 编辑模板会改变模板 ID 吗？**
A: 不会，模板 ID 保持不变。

**Q: 不同工作区的模板可以互相编辑吗？**
A: 不可以，只能编辑当前工作区的模板。

## 🚀 下一步

- [ ] 添加模板版本控制
- [ ] 添加模板导出功能
- [ ] 添加模板导入功能
- [ ] 添加模板分享功能
- [ ] 添加模板搜索功能


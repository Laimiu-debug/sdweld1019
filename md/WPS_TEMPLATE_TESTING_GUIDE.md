# WPS 模板数据一致性测试指南

## 测试目标

验证使用模板创建的 WPS 数据完整性和一致性，确保：
1. ✅ 卡片显示的数据与模板中填写的数据一致
2. ✅ 预览功能能正确显示 WPS 详情
3. ✅ 编辑功能能正确打开编辑页面
4. ✅ 模板系统真正发挥作用

## 前置条件

- [ ] 后端服务器已启动（`http://localhost:8000`）
- [ ] 前端开发服务器已启动（`http://localhost:5173` 或类似）
- [ ] 已登录系统
- [ ] 数据库中存在可用的 WPS 模板

## 测试步骤

### 第一步：创建 WPS（使用模板）

1. 访问 `http://localhost:5173/wps/create`
2. 在"选择模板"步骤中：
   - 选择焊接工艺（如：111-手工电弧焊）
   - 可选：选择标准（如：EN ISO 15609-1）
   - 从列表中选择一个模板
   - 点击"下一步"

3. 在"填写数据"步骤中：
   - **重要**: 填写以下关键字段（用于验证）：
     - WPS 编号：`TEST-WPS-001`
     - WPS 标题：`测试焊接工艺规程`
     - 焊接方法：`手工电弧焊`
     - 母材规格：`Q235 钢板`
     - 填充金属分类：`E7018`
   - 填写其他必填字段
   - 点击"提交"

4. 验证：
   - [ ] 页面显示"WPS创建成功"
   - [ ] 自动跳转到 WPS 列表页面

### 第二步：验证卡片显示

1. 在 WPS 列表页面（`/wps`）中找到刚创建的 WPS
2. 检查卡片上显示的信息：
   - [ ] WPS 编号显示为 `TEST-WPS-001`
   - [ ] 标题显示为 `测试焊接工艺规程`
   - [ ] 焊接方法显示为 `手工电弧焊`
   - [ ] 母材显示为 `Q235 钢板`
   - [ ] 填充金属显示为 `E7018`
   - [ ] 创建时间显示正确

**预期结果**: ✅ 卡片上显示的数据与模板中填写的数据完全一致

### 第三步：验证预览功能

1. 在卡片上找到"预览"按钮
2. 点击"预览"按钮
3. 在弹出的预览模态框中检查：
   - [ ] WPS 编号：`TEST-WPS-001`
   - [ ] 标题：`测试焊接工艺规程`
   - [ ] 状态：`草稿`
   - [ ] 焊接方法：`手工电弧焊`
   - [ ] 母材：`Q235 钢板`
   - [ ] 填充金属：`E7018`
   - [ ] 创建时间显示正确
   - [ ] 最后更新时间显示正确

**预期结果**: ✅ 预览模态框显示完整的 WPS 信息

### 第四步：验证编辑功能

1. 在预览模态框中点击"编辑"按钮
   或在卡片上点击"编辑"按钮

2. 验证：
   - [ ] 页面跳转到编辑页面（`/wps/{id}/edit`）
   - [ ] 编辑页面能正确加载 WPS 数据
   - [ ] 所有字段都显示了之前填写的值

**预期结果**: ✅ 编辑功能正确打开编辑页面

### 第五步：验证数据完整性

1. 在编辑页面中检查所有字段：
   - [ ] 基本信息字段完整
   - [ ] 模板中的所有字段都能显示
   - [ ] 没有丢失任何数据

2. 修改一个字段（如：焊接方法改为 `气体保护焊`）
3. 保存修改
4. 返回列表页面
5. 验证卡片上显示的是更新后的数据

**预期结果**: ✅ 数据完整性得到保证

## 故障排查

### 问题 1：卡片显示空值或虚假信息

**可能原因**:
- modules_data 未被正确保存
- 前端未正确提取 modules_data

**解决步骤**:
1. 打开浏览器开发者工具（F12）
2. 在 Network 标签中查看 `/api/v1/wps/` 的响应
3. 检查响应中是否包含 `modules_data` 字段
4. 如果包含，检查前端是否正确解析

### 问题 2：预览功能不显示数据

**可能原因**:
- previewRecord 未正确设置
- 预览模态框未正确渲染

**解决步骤**:
1. 打开浏览器控制台
2. 检查是否有 JavaScript 错误
3. 检查 previewRecord 是否包含数据

### 问题 3：编辑功能无法打开

**可能原因**:
- 路由配置错误
- 编辑页面不存在

**解决步骤**:
1. 检查路由配置
2. 验证编辑页面是否存在
3. 检查浏览器控制台错误

## 测试报告模板

```
测试日期: ____________________
测试人员: ____________________
测试环境: 开发环境 / 测试环境 / 生产环境

测试结果:
- 卡片显示: ✅ 通过 / ❌ 失败
- 预览功能: ✅ 通过 / ❌ 失败
- 编辑功能: ✅ 通过 / ❌ 失败
- 数据完整性: ✅ 通过 / ❌ 失败

问题描述:
_________________________________________________________________

建议:
_________________________________________________________________
```

## 性能测试

1. 创建多个 WPS（10+）
2. 访问列表页面
3. 检查页面加载时间
4. 检查是否有性能问题

## 兼容性测试

- [ ] Chrome 浏览器
- [ ] Firefox 浏览器
- [ ] Safari 浏览器
- [ ] Edge 浏览器

## 完成标准

所有以下条件都满足时，测试通过：
- ✅ 卡片显示的数据与模板中填写的数据一致
- ✅ 预览功能能正确显示 WPS 详情
- ✅ 编辑功能能正确打开编辑页面
- ✅ 没有 JavaScript 错误
- ✅ 没有性能问题


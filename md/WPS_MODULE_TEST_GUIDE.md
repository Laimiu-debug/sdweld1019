# WPS 模块管理系统 - 测试指南

## 🧪 测试环境准备

### 前置条件
1. 确保前端开发服务器正在运行
2. 确保后端API服务正常
3. 确保已登录系统

### 测试路径
- 模块管理页面: `/wps/modules`
- WPS创建页面: `/wps/create`

---

## 📋 测试用例

### 测试组 1: 预设模块预览功能

#### 测试用例 1.1: 预览预设模块
**步骤**:
1. 访问 `/wps/modules`
2. 确认在"预设模块"标签页
3. 找到任意预设模块（如"基本信息"）
4. 点击"预览"按钮

**预期结果**:
- ✅ 弹出模态框，标题为"模块预览"
- ✅ 显示模块名称、描述、字段数量
- ✅ 显示真实的表单字段（输入框、下拉框等）
- ✅ 字段按照实际布局排列（3列网格）
- ✅ 点击"关闭"按钮可关闭模态框

#### 测试用例 1.2: 预览不同类型的预设模块
**步骤**:
1. 预览"基本信息"模块（包含文本字段）
2. 预览"焊接参数"模块（包含数字字段）
3. 预览"技术图表"模块（包含图片字段）

**预期结果**:
- ✅ 不同类型的字段正确渲染
- ✅ 文本字段显示为输入框
- ✅ 数字字段显示为数字输入框，带单位
- ✅ 图片字段显示为上传组件

---

### 测试组 2: 预设模块复制功能

#### 测试用例 2.1: 复制预设模块
**步骤**:
1. 访问 `/wps/modules`
2. 在"预设模块"标签页找到"基本信息"模块
3. 点击"复制"按钮

**预期结果**:
- ✅ 弹出"创建自定义模块"模态框
- ✅ 标题显示"复制模块: 基本信息"
- ✅ 显示蓝色提示框："您正在复制预设模块"
- ✅ 模块名称自动填充为"基本信息(副本)"
- ✅ 描述、图标、分类等字段自动填充
- ✅ 所有字段列表自动填充

#### 测试用例 2.2: 修改并保存复制的模块
**步骤**:
1. 复制"基本信息"模块
2. 修改名称为"我的基本信息"
3. 添加一个新字段
4. 点击"保存副本"

**预期结果**:
- ✅ 显示成功消息："自定义模块创建成功！"
- ✅ 模态框自动关闭
- ✅ 切换到"自定义模块"标签页
- ✅ 新模块出现在列表中

---

### 测试组 3: 自定义模块预览功能

#### 测试用例 3.1: 预览自定义模块
**步骤**:
1. 访问 `/wps/modules`
2. 切换到"自定义模块"标签页
3. 找到任意自定义模块
4. 点击"预览"按钮

**预期结果**:
- ✅ 弹出模态框，标题为"模块预览"
- ✅ 显示模块的真实表单效果（不是字段列表）
- ✅ 字段按照实际布局排列
- ✅ 与预设模块预览效果一致

#### 测试用例 3.2: 对比新旧预览方式
**对比点**:
- ❌ 旧方式：显示字段列表表格
- ✅ 新方式：显示真实表单渲染效果

---

### 测试组 4: 自定义模块复制功能

#### 测试用例 4.1: 复制自定义模块
**步骤**:
1. 访问 `/wps/modules`
2. 切换到"自定义模块"标签页
3. 找到任意自定义模块
4. 点击"复制"按钮

**预期结果**:
- ✅ 弹出"创建自定义模块"模态框
- ✅ 标题显示"复制模块: [模块名称]"
- ✅ 所有字段自动填充
- ✅ 模块名称添加"(副本)"后缀

#### 测试用例 4.2: 保存复制的自定义模块
**步骤**:
1. 复制自定义模块
2. 修改名称
3. 点击"保存副本"

**预期结果**:
- ✅ 创建成功
- ✅ 新模块出现在列表中
- ✅ 原模块不受影响

---

### 测试组 5: 技术图表 - 手动上传

#### 测试用例 5.1: 上传坡口图
**步骤**:
1. 创建新WPS或编辑现有WPS
2. 选择包含"技术图表"模块的模板
3. 找到"坡口图"字段
4. 点击上传区域
5. 选择一张图片文件（PNG/JPG）

**预期结果**:
- ✅ 图片上传成功
- ✅ 显示图片预览（卡片式）
- ✅ 可以删除已上传的图片
- ✅ 可以重新上传

#### 测试用例 5.2: 上传焊层焊道图
**步骤**:
1. 在同一WPS中找到"焊层焊道图"字段
2. 上传图片

**预期结果**:
- ✅ 上传功能正常
- ✅ 图片预览正常

---

### 测试组 6: 技术图表 - 自动生成

#### 测试用例 6.1: 生成坡口图
**步骤**:
1. 创建新WPS，选择包含"技术图表"模块的模板
2. 找到"坡口图"字段
3. 点击"自动生成坡口图"按钮
4. 在弹出的生成器中：
   - 选择坡口类型：V型
   - 设置坡口角度：60°
   - 设置根部间隙：2mm
   - 设置厚度：10mm
5. 观察右侧预览区域

**预期结果**:
- ✅ 弹出"生成坡口图"模态框
- ✅ 左侧显示参数输入表单
- ✅ 右侧显示Canvas预览
- ✅ 初始加载时显示默认图表
- ✅ 修改参数时图表实时更新
- ✅ 图表显示正确的坡口形状

#### 测试用例 6.2: 测试不同坡口类型
**步骤**:
1. 打开坡口图生成器
2. 依次选择：V型、U型、J型、X型

**预期结果**:
- ✅ V型：显示V形坡口
- ✅ U型：显示U形坡口（圆弧）
- ✅ J型：显示J形坡口
- ✅ X型：显示X形坡口

#### 测试用例 6.3: 生成并应用坡口图
**步骤**:
1. 打开坡口图生成器
2. 设置参数
3. 点击"生成图表"按钮

**预期结果**:
- ✅ 显示成功消息："图表生成成功！"
- ✅ 模态框自动关闭
- ✅ 图表自动填充到"坡口图"字段
- ✅ 字段显示图片预览

#### 测试用例 6.4: 下载生成的图表
**步骤**:
1. 打开坡口图生成器
2. 设置参数
3. 点击"下载"按钮

**预期结果**:
- ✅ 显示成功消息："图表已下载"
- ✅ 浏览器下载PNG文件
- ✅ 文件名格式：`diagram_groove_[时间戳].png`
- ✅ 图片内容正确

#### 测试用例 6.5: 生成焊层焊道图
**步骤**:
1. 找到"焊层焊道图"字段
2. 点击"自动生成焊层焊道图"按钮
3. 设置参数：
   - 焊层数量：3层
   - 每层焊道数：2道
4. 点击"生成图表"

**预期结果**:
- ✅ 显示3层焊层
- ✅ 每层显示2道焊道
- ✅ 不同层使用不同颜色
- ✅ 显示层号和道号
- ✅ 生成成功并填充到字段

#### 测试用例 6.6: 测试焊层焊道图参数范围
**步骤**:
1. 测试最小值：1层，1道
2. 测试最大值：10层，10道
3. 测试中间值：5层，3道

**预期结果**:
- ✅ 所有参数范围内的值都能正确生成
- ✅ 图表布局合理，不重叠

---

### 测试组 7: 集成测试

#### 测试用例 7.1: 完整的WPS创建流程
**步骤**:
1. 创建新WPS
2. 选择包含"技术图表"模块的模板
3. 填写基本信息
4. 使用自动生成功能生成坡口图
5. 使用手动上传功能上传焊层焊道图
6. 保存WPS

**预期结果**:
- ✅ 所有功能正常工作
- ✅ 图表正确保存
- ✅ 重新打开WPS时图表正确显示

#### 测试用例 7.2: 模块预览在创建器中的表现
**步骤**:
1. 创建自定义模块，包含图片字段
2. 切换到"预览"标签页
3. 观察图片字段的渲染

**预期结果**:
- ✅ 图片字段正确显示为上传组件
- ✅ 如果是坡口图/焊层焊道图字段，显示生成按钮

---

## 🐛 已知问题和注意事项

### 注意事项
1. **图表生成器性能**: 复杂图表可能需要一些时间渲染
2. **图片大小**: 建议上传的图片不超过5MB
3. **浏览器兼容性**: Canvas功能需要现代浏览器支持

### 潜在问题
1. **图表质量**: 自动生成的图表是简化版本，可能不满足所有需求
2. **参数验证**: 某些极端参数值可能导致图表显示异常

---

## ✅ 测试检查清单

### 功能完整性
- [ ] 预设模块预览功能
- [ ] 预设模块复制功能
- [ ] 自定义模块预览功能
- [ ] 自定义模块复制功能
- [ ] 图表手动上传功能
- [ ] 坡口图自动生成功能
- [ ] 焊层焊道图自动生成功能
- [ ] 图表下载功能

### 用户体验
- [ ] 所有按钮响应及时
- [ ] 错误提示清晰
- [ ] 成功消息友好
- [ ] 模态框交互流畅
- [ ] 图表预览实时更新

### 数据完整性
- [ ] 复制的模块数据完整
- [ ] 生成的图表正确保存
- [ ] 上传的图片正确保存
- [ ] 删除操作不影响其他数据

---

## 📊 测试报告模板

```
测试日期: ____________________
测试人员: ____________________
测试环境: ____________________

| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1.1 预览预设模块 | ✅/❌ | |
| 1.2 预览不同类型模块 | ✅/❌ | |
| 2.1 复制预设模块 | ✅/❌ | |
| 2.2 保存复制的模块 | ✅/❌ | |
| 3.1 预览自定义模块 | ✅/❌ | |
| 4.1 复制自定义模块 | ✅/❌ | |
| 5.1 上传坡口图 | ✅/❌ | |
| 6.1 生成坡口图 | ✅/❌ | |
| 6.5 生成焊层焊道图 | ✅/❌ | |
| 7.1 完整WPS创建流程 | ✅/❌ | |

总体评价: ____________________
发现的问题: ____________________
改进建议: ____________________
```

---

## 🎯 测试优先级

### P0 - 核心功能（必须通过）
- 预设模块预览
- 自定义模块预览
- 图表自动生成

### P1 - 重要功能（应该通过）
- 模块复制功能
- 图表手动上传
- 图表下载

### P2 - 辅助功能（可以有小问题）
- 参数实时更新
- 图表样式优化

---

## 📞 问题反馈

如果在测试过程中发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 预期结果
4. 实际结果
5. 截图（如有）


# Word 导出图片显示 - 测试指南

## 测试环境准备

### 前置条件
- WPS 系统已部署
- 后端服务正在运行
- 前端应用已启动
- 浏览器开发者工具可用

## 测试场景

### 测试 1：焊接接头示意图 V4 导出

**步骤**：
1. 打开 WPS 编辑页面
2. 找到"焊接接头示意图"字段
3. 点击"自动生成"按钮
4. 在生成器中调整参数
5. 点击"生成"按钮
6. 验证图片在页面上显示正确
7. 点击"保存"按钮保存 WPS
8. 切换到"文档编辑"模式
9. 点击"导出为 Word"按钮
10. 等待导出完成

**预期结果**：
- ✅ Word 文件成功下载
- ✅ 打开 Word 文件后，焊接接头示意图正确显示
- ✅ 图片清晰，没有损坏或模糊

### 测试 2：坡口图导出

**步骤**：
1. 打开 WPS 编辑页面
2. 找到"坡口图"字段
3. 点击"自动生成"按钮
4. 在生成器中调整参数
5. 点击"生成"按钮
6. 保存 WPS
7. 导出为 Word
8. 打开 Word 文件验证

**预期结果**：
- ✅ 坡口图在 Word 中正确显示

### 测试 3：焊层焊道图导出

**步骤**：
1. 打开 WPS 编辑页面
2. 找到"焊层焊道图"字段
3. 点击"自动生成"按钮
4. 在生成器中调整参数
5. 点击"生成"按钮
6. 保存 WPS
7. 导出为 Word
8. 打开 Word 文件验证

**预期结果**：
- ✅ 焊层焊道图在 Word 中正确显示

### 测试 4：上传图片导出

**步骤**：
1. 打开 WPS 编辑页面
2. 找到任何图片字段
3. 点击"上传图片"按钮
4. 选择本地图片文件
5. 验证图片上传成功
6. 保存 WPS
7. 导出为 Word
8. 打开 Word 文件验证

**预期结果**：
- ✅ 上传的图片在 Word 中正确显示

### 测试 5：多个图片导出

**步骤**：
1. 打开 WPS 编辑页面
2. 生成多个示意图（焊接接头、坡口图、焊层焊道图）
3. 上传一张图片
4. 保存 WPS
5. 导出为 Word
6. 打开 Word 文件验证

**预期结果**：
- ✅ 所有图片都在 Word 中正确显示
- ✅ 图片排列整齐，没有重叠或错位

### 测试 6：PQR 导出

**步骤**：
1. 打开 PQR 编辑页面
2. 生成或上传图片
3. 保存 PQR
4. 导出为 Word
5. 打开 Word 文件验证

**预期结果**：
- ✅ PQR 中的图片在 Word 中正确显示

### 测试 7：pPQR 导出

**步骤**：
1. 打开 pPQR 编辑页面
2. 生成或上传图片
3. 保存 pPQR
4. 导出为 Word
5. 打开 Word 文件验证

**预期结果**：
- ✅ pPQR 中的图片在 Word 中正确显示

## 后端日志检查

### 正常日志（应该看到）
```
[Word导出] 处理图片: data:image/png;base64,...
[Word导出] base64图片格式: png, 数据长度: 12345
[Word导出] 成功添加base64图片，大小: 9876 字节
```

### 错误日志（不应该看到）
```
[Word导出] 图片没有src属性，跳过
[Word导出] base64图片格式错误，找不到逗号分隔符
[Word导出] base64数据为空
[Word导出] base64解码失败
[Word导出] 添加图片失败
```

## 浏览器控制台检查

### 正常情况
- 没有 JavaScript 错误
- 导出成功提示显示
- 文件下载正常

### 异常情况
- 导出失败提示
- 网络错误
- 文件下载失败

## Word 文件检查

### 打开 Word 文件
1. 使用 Microsoft Word 或 LibreOffice 打开导出的 .docx 文件
2. 检查文档内容

### 检查项
- [ ] 文档标题正确
- [ ] 文档编号正确
- [ ] 所有表格显示正确
- [ ] 所有图片显示正确
- [ ] 图片清晰，没有损坏
- [ ] 图片位置正确（居中）
- [ ] 图片大小合适
- [ ] 页脚显示正确

## 性能测试

### 导出时间
- 记录导出开始时间
- 记录导出完成时间
- 计算导出耗时
- 预期：< 10 秒

### 文件大小
- 检查导出的 Word 文件大小
- 预期：< 10 MB

### 内存使用
- 监控后端内存使用
- 预期：没有明显增长

## 兼容性测试

### 操作系统
- [ ] Windows
- [ ] macOS
- [ ] Linux

### 浏览器
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

### Word 版本
- [ ] Microsoft Word 2016
- [ ] Microsoft Word 2019
- [ ] Microsoft Word 365
- [ ] LibreOffice Writer

## 回归测试

### 检查其他功能是否受影响
- [ ] PDF 导出功能正常
- [ ] 页面编辑功能正常
- [ ] 图片上传功能正常
- [ ] 图片预览功能正常
- [ ] 图片删除功能正常

## 完成标准

所有测试都通过，且：
- ✅ Word 文件中的所有图片都正确显示
- ✅ 没有"图片加载失败"的占位符
- ✅ 后端日志显示成功添加图片
- ✅ 没有 JavaScript 错误
- ✅ 导出时间 < 10 秒
- ✅ 文件大小 < 10 MB
- ✅ 其他功能不受影响

## 问题排查

### 问题：Word 中图片不显示

**排查步骤**：
1. 检查后端日志是否有错误
2. 检查浏览器控制台是否有错误
3. 检查 base64 数据是否完整
4. 尝试重新导出
5. 尝试用不同的 Word 版本打开

### 问题：导出失败

**排查步骤**：
1. 检查后端服务是否正在运行
2. 检查网络连接
3. 检查浏览器控制台错误
4. 检查后端日志
5. 尝试刷新页面重新导出

### 问题：导出很慢

**排查步骤**：
1. 检查网络连接速度
2. 检查后端服务性能
3. 检查图片数量和大小
4. 尝试减少图片数量
5. 检查服务器资源使用情况

## 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: [名字]
测试环境: [操作系统] [浏览器] [Word版本]

测试结果:
- 测试 1: [通过/失败]
- 测试 2: [通过/失败]
- 测试 3: [通过/失败]
- 测试 4: [通过/失败]
- 测试 5: [通过/失败]
- 测试 6: [通过/失败]
- 测试 7: [通过/失败]

问题描述:
[如有问题，详细描述]

建议:
[改进建议]
```


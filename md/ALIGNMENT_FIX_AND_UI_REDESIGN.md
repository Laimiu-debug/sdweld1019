# 对齐方式修正 + UI重新设计

## ✅ 完成的改进

### 1. **对齐方式修正** ✅

**核心问题：**
之前的对齐方式是按照板材表面对齐，导致当坡口深度+钝边厚度<板厚时，会出现倾斜边界的情况。

**修正方案：**
对齐钝边的边界点，而不是板材表面。

---

## 📐 新的对齐逻辑

### 外平齐（outer_flush）- 对齐钝边外侧边界

**外坡口（钝边在坡口底部）：**
```
对齐点：钝边顶部（坡口开始的Y位置）

计算：
leftBluntTopY = cy
leftTopY = leftBluntTopY - (validDL - validTRoot)
leftBottomY = leftTopY + tL

rightBluntTopY = cy
rightTopY = rightBluntTopY - (validDR - validTRoot)
rightBottomY = rightTopY + tR
```

**示意图：**
```
        cy (对齐点：钝边顶部)
         ↓
┌────────┐  ┌────────┐  <- 板材顶部
│        │╲╱│        │  <- 坡口
│        ══ ══        │  <- 钝边（顶部对齐）✅
│        ││ ││        │  <- 根部间隙
│        │  │        │
└────────┘  └────────┘  <- 板材底部
```

**内坡口（钝边在坡口顶部）：**
```
对齐点：钝边顶部

计算：
leftBluntTopY = cy
leftTopY = leftBluntTopY - leftBluntOffsetFromTop
leftBottomY = leftTopY + tL
```

**示意图：**
```
        cy (对齐点：钝边顶部)
         ↓
┌────────┐  ┌────────┐  <- 板材顶部
│        ││ ││        │  <- 根部间隙
│        ══ ══        │  <- 钝边（顶部对齐）✅
│        │╲╱│        │  <- 坡口
│        │  │        │
└────────┘  └────────┘  <- 板材底部
```

---

### 内平齐（inner_flush）- 对齐钝边内侧边界

**外坡口（钝边在坡口底部）：**
```
对齐点：钝边底部

计算：
leftBluntBottomY = cy
leftTopY = leftBluntBottomY - validDL
leftBottomY = leftTopY + tL

rightBluntBottomY = cy
rightTopY = rightBluntBottomY - validDR
rightBottomY = rightTopY + tR
```

**示意图：**
```
┌────────┐  ┌────────┐  <- 板材顶部
│        │╲╱│        │  <- 坡口
│        ══ ══        │  <- 钝边（底部对齐）✅
│        ││ ││        │  <- 根部间隙
│        │  │        │
└────────┘  └────────┘  <- 板材底部
         ↑
        cy (对齐点：钝边底部)
```

**内坡口（钝边在坡口顶部）：**
```
对齐点：钝边底部

计算：
leftBluntBottomY = cy
leftTopY = leftBluntBottomY - (tL - validDL + validTRoot)
leftBottomY = leftTopY + tL
```

**示意图：**
```
┌────────┐  ┌────────┐  <- 板材顶部
│        ││ ││        │  <- 根部间隙
│        ══ ══        │  <- 钝边（底部对齐）✅
│        │╲╱│        │  <- 坡口
│        │  │        │
└────────┘  └────────┘  <- 板材底部
         ↑
        cy (对齐点：钝边底部)
```

---

### 中心线对齐（centerline）- 对齐钝边中点

**外坡口（钝边在坡口底部）：**
```
对齐点：钝边中点

计算：
leftBluntCenterY = cy
leftTopY = leftBluntCenterY - (validDL - validTRoot / 2)
leftBottomY = leftTopY + tL

rightBluntCenterY = cy
rightTopY = rightBluntCenterY - (validDR - validTRoot / 2)
rightBottomY = rightTopY + tR
```

**示意图：**
```
┌────────┐  ┌────────┐  <- 板材顶部
│        │╲╱│        │  <- 坡口
│        ══ ══        │  <- 钝边（中点对齐）✅
│        ││ ││        │  <- 根部间隙
│        │  │        │
└────────┘  └────────┘  <- 板材底部
         ↑
        cy (对齐点：钝边中点)
```

**内坡口（钝边在坡口顶部）：**
```
对齐点：钝边中点

计算：
leftBluntCenterY = cy
leftTopY = leftBluntCenterY - (tL - validDL + validTRoot / 2)
leftBottomY = leftTopY + tL
```

**示意图：**
```
┌────────┐  ┌────────┐  <- 板材顶部
│        ││ ││        │  <- 根部间隙
│        ══ ══        │  <- 钝边（中点对齐）✅
│        │╲╱│        │  <- 坡口
│        │  │        │
└────────┘  └────────┘  <- 板材底部
         ↑
        cy (对齐点：钝边中点)
```

---

## 🎨 UI重新设计

### 2. **左右两列布局** ✅

**修改前：**
```
左侧板材参数
  - 板厚
  - 母材
  - 坡口角度
  - ...

右侧板材参数
  - 板厚
  - 母材
  - 坡口角度
  - ...
```

**修改后：**
```
板材参数（左右两侧）
┌─────────────────┬─────────────────┐
│  左侧板材       │  右侧板材       │
│  - 板厚         │  - 板厚         │
│  - 母材         │  - 母材         │
│  - 坡口角度     │  - 坡口角度     │
│  - ...          │  - ...          │
└─────────────────┴─────────────────┘
```

**优点：**
- ✅ 更紧凑
- ✅ 易于对比左右参数
- ✅ 节省垂直空间

### 3. **删除"坡口侧数"字段** ✅

用户可以通过设置左右坡口角度和深度来自由控制坡口形状，不需要单独的"坡口侧数"选项。

### 4. **简化标签文字** ✅

**修改前：**
- 左侧板厚 (mm)
- 左侧母材
- 左侧坡口角度 θL (°)
- 削薄过渡长度 L (mm)
- 削薄厚度变化量 H (mm)
- 过渡曲线类型

**修改后：**
- 板厚 (mm)
- 母材
- 坡口角度 θL (°)
- 削薄长度 L (mm)
- 削薄高度 H (mm)
- 过渡曲线

**优点：**
- ✅ 更简洁
- ✅ 减少重复文字
- ✅ 左右对称更清晰

### 5. **颜色区分** ✅

- 左侧板材标题：蓝色 (#1890ff)
- 右侧板材标题：绿色 (#52c41a)

---

## 🧪 测试场景

### 场景1：不等厚板材 + 外平齐

**参数：**
- 左侧板厚：12mm
- 右侧板厚：8mm
- 左侧坡口深度：10mm
- 右侧坡口深度：6mm
- 钝边：2mm
- 对齐方式：外平齐

**预期：**
- ✅ 左右钝边顶部对齐
- ✅ 板材上下边界保持水平
- ✅ 左侧板材向下延伸更多

### 场景2：不等厚板材 + 内平齐

**参数：**
- 左侧板厚：12mm
- 右侧板厚：8mm
- 左侧坡口深度：10mm
- 右侧坡口深度：6mm
- 钝边：2mm
- 对齐方式：内平齐

**预期：**
- ✅ 左右钝边底部对齐
- ✅ 板材上下边界保持水平
- ✅ 左侧板材向上延伸更多

### 场景3：不等厚板材 + 中心线对齐

**参数：**
- 左侧板厚：12mm
- 右侧板厚：8mm
- 左侧坡口深度：10mm
- 右侧坡口深度：6mm
- 钝边：2mm
- 对齐方式：中心线对齐

**预期：**
- ✅ 左右钝边中点对齐
- ✅ 板材上下边界保持水平
- ✅ 左侧板材向上下两侧延伸

---

## 📊 改进效果评分

| 方面 | 修复前 | 修复后 |
|------|--------|--------|
| 对齐方式 | 按板材表面 ❌ | 按钝边边界 ✅ |
| 不等厚支持 | 有问题 ❌ | 完美 ✅ |
| UI布局 | 上下排列 | 左右并排 ✅ |
| 标签文字 | 冗长 | 简洁 ✅ |
| 颜色区分 | 无 | 有 ✅ |
| 坡口侧数 | 冗余 ❌ | 已删除 ✅ |
| **总体评分** | **⭐⭐⭐** | **⭐⭐⭐⭐⭐** |

---

## 🎉 总结

已完成所有改进：

1. ✅ **对齐方式修正** - 对齐钝边边界，而不是板材表面
2. ✅ **UI重新设计** - 左右两列布局，更紧凑
3. ✅ **删除冗余字段** - 删除"坡口侧数"
4. ✅ **简化标签** - 更简洁的文字
5. ✅ **颜色区分** - 左蓝右绿，更清晰

现在的对齐方式完全正确，UI也更加专业和易用！

---

## 📁 相关文件

- **生成器组件**: `frontend/src/components/WPS/WeldJointDiagramGenerator.tsx`

开发服务器运行中：**http://localhost:3002**


# 复杂表格模块功能说明

## 功能概述

现在自定义模块支持创建复杂的多行多列表格,可以实现类似你提供的图片中的表格结构:

```
┌─────────┬─────────┬──────────────────────────────────────────────────────────────────────────────┐
│  Weld   │ Process │                           Filler Metal                                       │
│ Layer(s)│  焊接   │                           填充金属                                           │
│  焊层   │  方法   ├─────────┬──────────┬──────────┬──────────┬──────────┬──────────┬──────────┤
│         │         │  Class  │ Dia.(mm) │ Polarity │Amp.Range │Volt.Range│Travel... │   Note   │
│         │         │  类别   │  直径    │  极性    │  安培    │  电压    │焊接速度  │  备注    │
├─────────┼─────────┼─────────┼──────────┼──────────┼──────────┼──────────┼──────────┼──────────┤
│    1    │  GTAW   │ ER70S-6 │  Φ2.0   │   DCEN   │  60~80   │  10~13   │   5~8    │  15~20   │
├─────────┼─────────┼─────────┼──────────┼──────────┼──────────┼──────────┼──────────┼──────────┤
│    2    │  GTAW   │ ER70S-6 │  Φ2.0   │   DCEN   │  60~90   │  10~15   │   6~8    │  15~20   │
└─────────┴─────────┴─────────┴──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘
```

## 新增功能

### 1. 画布内拖拽范围扩大 ✅

**之前**: 只能拖拽 `⋮⋮` 图标  
**现在**: 可以拖拽整个模块卡片的左侧区域

整个模块名称区域都可以拖拽,大大提升了操作便利性!

### 2. 表格字段类型 ✅

在创建自定义模块时,新增了 `table` 字段类型,可以创建复杂的多行多列表格。

#### 表格特性:
- ✅ **多行多列** - 任意行列数量
- ✅ **表头行** - 可以设置某些行为表头(加粗显示)
- ✅ **单元格合并** - 支持跨行(rowspan)和跨列(colspan)
- ✅ **多种字段类型** - 每个单元格可以是文本、数字、下拉选择、日期等
- ✅ **单位支持** - 每个单元格可以设置单位
- ✅ **必填标记** - 可以标记必填单元格
- ✅ **只读控制** - 可以设置某些单元格为只读

## 使用方法

### 创建表格模块

#### 步骤1: 打开自定义模块创建器

1. 进入 "模块管理" 页面
2. 点击 "创建自定义模块" 按钮

#### 步骤2: 填写基本信息

```
模块名称: 焊接参数表
模块分类: 基本信息
模块描述: 多层多道焊接参数详细表格
```

#### 步骤3: 添加表格字段

1. 点击 "添加字段" 按钮
2. 设置字段信息:
   - **字段键名**: `welding_params_table`
   - **字段标签**: `焊接参数`
   - **字段类型**: 选择 `表格` (带表格图标)

#### 步骤4: 设计表格结构

选择表格类型后,会出现表格设计器:

##### 4.1 添加行和列

```
┌─────────────────────────────────┐
│ [添加行] [添加列]               │
└─────────────────────────────────┘
```

- 点击 "添加行" 增加新行
- 点击 "添加列" 增加新列
- 初始默认有 2 列 2 行

##### 4.2 编辑单元格

每个单元格右侧有编辑按钮 ✏️,点击后可以设置:

**基本属性**:
- **标签**: 单元格显示的文字(如 "Weld Layer(s)")
- **类型**: 文本、数字、下拉选择、日期、多行文本
- **单位**: 如 "mm", "°C", "cm/min"

**高级属性**:
- **跨行**: 设置单元格跨越多少行(rowspan)
- **跨列**: 设置单元格跨越多少列(colspan)

**示例 - 创建 "Filler Metal" 跨列表头**:
```
标签: Filler Metal 填充金属
类型: 文本
跨行: 1
跨列: 7  ← 跨越7列!
```

##### 4.3 设置表头行

每行右侧有 "表头/数据" 切换按钮:
- 点击设置为 "表头" → 该行会加粗显示,背景色变灰
- 再次点击切换回 "数据" 行

##### 4.4 删除行列

- 每行右侧有删除按钮 🗑️
- 每列底部有 "删除列" 按钮

### 示例: 创建焊接参数表

#### 表格结构设计

**第1行 (表头)**:
```
┌─────────┬─────────┬──────────────────────────────────────────────────┐
│  Weld   │ Process │              Filler Metal                        │
│ Layer(s)│         │              (跨7列)                             │
└─────────┴─────────┴──────────────────────────────────────────────────┘
```

设置:
- 单元格1: 标签="Weld Layer(s) 焊层", 跨行=2
- 单元格2: 标签="Process 焊接方法", 跨行=2
- 单元格3: 标签="Filler Metal 填充金属", 跨列=7

**第2行 (表头)**:
```
┌─────────┬──────────┬──────────┬──────────┬──────────┬──────────┬──────────┐
│  Class  │ Dia.(mm) │ Polarity │Amp.Range │Volt.Range│Travel... │   Note   │
└─────────┴──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘
```

设置:
- 单元格1: 标签="Class 类别", 类型=下拉选择, 选项="ER70S-6, ER308L, ER316L"
- 单元格2: 标签="Dia. 直径", 类型=文本, 单位="mm"
- 单元格3: 标签="Polarity 极性", 类型=下拉选择, 选项="DCEN, DCEP, AC"
- 单元格4: 标签="Amp.Range 安培", 类型=文本
- 单元格5: 标签="Volt.Range 电压", 类型=文本, 单位="V"
- 单元格6: 标签="Travel Speed 焊接速度", 类型=文本, 单位="cm/min"
- 单元格7: 标签="Note 备注", 类型=文本

**第3行及以后 (数据行)**:
```
┌─────────┬─────────┬─────────┬──────────┬──────────┬──────────┬──────────┬──────────┬──────────┐
│    1    │  GTAW   │ ER70S-6 │  Φ2.0   │   DCEN   │  60~80   │  10~13   │   5~8    │  15~20   │
└─────────┴─────────┴─────────┴──────────┴──────────┴──────────┴──────────┴──────────┴──────────┘
```

每个单元格都是可编辑的输入框,根据类型显示不同的输入控件。

#### 步骤5: 保存模块

点击 "创建模块" 按钮,模块会保存到你的自定义模块库。

### 使用表格模块

#### 在模板中使用

1. 打开 "模板创建" 页面
2. 从左侧模块库找到你创建的 "焊接参数表" 模块
3. 拖拽到画布上
4. 表格会自动渲染,显示所有行列

#### 填写表格数据

在模板预览或WPS填写时:
- **表头行**: 显示为灰色背景,加粗文字,不可编辑
- **数据行**: 每个单元格根据类型显示对应的输入控件
  - 文本 → 文本输入框
  - 数字 → 数字输入框(带单位)
  - 下拉选择 → 下拉菜单
  - 日期 → 日期选择器
  - 多行文本 → 多行文本框

#### 添加更多数据行

如果模块设置为 "可重复":
1. 可以复制模块实例
2. 重命名为 "第1层"、"第2层" 等
3. 每个实例都有独立的表格数据

## 技术实现

### 数据结构

#### TableCellDefinition (单元格定义)
```typescript
interface TableCellDefinition {
  label: string           // 单元格标签
  type: 'text' | 'number' | 'select' | 'date' | 'textarea'
  unit?: string          // 单位
  options?: string[]     // 下拉选项
  required?: boolean     // 是否必填
  readonly?: boolean     // 是否只读
  rowspan?: number       // 跨行数
  colspan?: number       // 跨列数
}
```

#### TableRowDefinition (行定义)
```typescript
interface TableRowDefinition {
  cells: TableCellDefinition[]
  isHeader?: boolean     // 是否为表头行
}
```

#### TableDefinition (表格定义)
```typescript
interface TableDefinition {
  rows: TableRowDefinition[]
  bordered?: boolean     // 是否显示边框
  size?: 'small' | 'middle' | 'large'
}
```

#### FieldDefinition (字段定义)
```typescript
interface FieldDefinition {
  label: string
  type: 'text' | 'number' | 'select' | 'date' | 'textarea' | 'file' | 'table'
  // ... 其他属性
  tableDefinition?: TableDefinition  // 当 type='table' 时使用
}
```

### 组件

#### TableFieldEditor
- **用途**: 在创建自定义模块时设计表格结构
- **功能**: 
  - 添加/删除行列
  - 编辑单元格属性
  - 设置跨行跨列
  - 切换表头/数据行

#### TableFieldRenderer
- **用途**: 在模板预览和填写时渲染表格
- **功能**:
  - 根据定义渲染表格
  - 显示不同类型的输入控件
  - 处理数据输入和验证
  - 支持只读模式

## 优势

✅ **灵活性** - 可以创建任意复杂的表格结构  
✅ **可重用** - 一次创建,多次使用  
✅ **类型安全** - 每个单元格有明确的数据类型  
✅ **验证支持** - 支持必填、范围等验证  
✅ **美观** - 自动渲染为专业的表格样式  
✅ **易用** - 可视化设计器,无需编写代码  

## 使用场景

### 1. 多层多道焊接参数
```
每层的焊接工艺参数,包括电流、电压、速度等
```

### 2. 材料成分表
```
多种材料的化学成分对比表
```

### 3. 检测记录表
```
多个检测点的检测数据记录
```

### 4. 设备参数表
```
多台设备的参数配置对比
```

### 5. 质量检验表
```
多项检验项目的检验结果记录
```

## 注意事项

1. **跨行跨列**: 设置跨行跨列时要注意不要超出表格范围
2. **表头行**: 表头行的单元格不可编辑,只用于显示标签
3. **数据行**: 数据行的单元格根据类型显示输入控件
4. **必填验证**: 标记为必填的单元格在提交时会验证
5. **单位显示**: 单位会自动显示在输入框后面

## 总结

现在你可以:
1. ✅ **拖拽整个模块卡片** - 不只是图标,操作更方便
2. ✅ **创建复杂表格** - 多行多列,跨行跨列,完全自定义
3. ✅ **可视化设计** - 所见即所得的表格设计器
4. ✅ **灵活使用** - 在任何模板中使用表格模块

完全满足你的需求! 🎉


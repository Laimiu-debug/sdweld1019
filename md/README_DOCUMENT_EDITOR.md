# 📝 WPS文档编辑器使用说明

## 🎉 部署状态

✅ **前端依赖**: 已安装  
✅ **后端依赖**: 已安装  
✅ **功能测试**: 5/5 通过  
✅ **代码检查**: 无错误  

---

## 🚀 立即开始（3步）

### 步骤1: 数据库迁移（仅需一次）

**选项A - 使用Python脚本（推荐）**:
```bash
cd backend
python run_document_html_migration.py
```

**选项B - 手动执行SQL**:
```bash
cd backend
psql -U postgres -d your_database_name -f migrations/add_document_html_to_wps.sql
```

### 步骤2: 启动后端服务
```bash
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 步骤3: 启动前端服务
```bash
cd frontend
npm run dev
```

**完成！** 访问 `http://localhost:5173/wps` 开始使用

---

## 📖 功能使用指南

### 1. 进入文档编辑模式

1. 打开任意WPS编辑页面
2. 在页面顶部找到模式切换按钮
3. 点击 **"文档编辑"** 标签

### 2. 使用编辑器工具栏

#### 基础操作
- **保存**: 保存当前文档内容
- **导出Word**: 下载.docx文件
- **导出PDF**: 下载PDF文件（需要GTK+）
- **打印**: 使用浏览器打印（可另存为PDF）

#### 文本格式
- **粗体**: Ctrl+B 或点击 **B** 按钮
- **斜体**: Ctrl+I 或点击 *I* 按钮
- **下划线**: Ctrl+U 或点击 <u>U</u> 按钮
- **删除线**: 点击 ~~S~~ 按钮
- **文本颜色**: 点击颜色选择器

#### 段落格式
- **标题1**: 点击 H1 按钮
- **标题2**: 点击 H2 按钮
- **标题3**: 点击 H3 按钮
- **左对齐**: 点击对齐按钮
- **居中**: 点击居中按钮
- **右对齐**: 点击右对齐按钮
- **两端对齐**: 点击两端对齐按钮

#### 列表
- **有序列表**: 点击 1. 按钮
- **无序列表**: 点击 • 按钮

#### 表格操作
1. **插入表格**: 点击"插入表格"按钮
2. **添加行**: 点击"添加行"按钮
3. **添加列**: 点击"添加列"按钮
4. **删除行**: 点击"删除行"按钮
5. **删除列**: 点击"删除列"按钮
6. **删除表格**: 点击"删除表格"按钮

#### 图片
- **插入图片**: 点击"插入图片"按钮，输入图片URL

#### 其他
- **撤销**: Ctrl+Z 或点击撤销按钮
- **重做**: Ctrl+Y 或点击重做按钮
- **水平线**: 点击"水平线"按钮

### 3. 保存文档

1. 编辑完成后，点击工具栏的 **"保存"** 按钮
2. 系统会自动保存HTML内容到数据库
3. 保存成功后会显示提示消息

### 4. 导出文档

#### 导出Word（推荐）
1. 点击 **"导出Word"** 按钮
2. 浏览器自动下载.docx文件
3. 文件名格式: `WPS_{编号}_{日期}.docx`
4. 可用Microsoft Word或WPS Office打开

#### 导出PDF（可选）
**方法A - 浏览器打印（推荐）**:
1. 点击 **"打印"** 按钮
2. 在打印对话框中选择"另存为PDF"
3. 选择保存位置

**方法B - 直接导出（需要GTK+）**:
1. 点击 **"导出PDF"** 按钮
2. 浏览器自动下载.pdf文件

---

## 💡 使用技巧

### 1. 从表单模式切换到文档模式
- 系统会自动将模块化数据转换为HTML
- 转换是**无损**的，所有数据都会保留
- 可以在文档模式下自由编辑和排版

### 2. 从文档模式切换回表单模式
- ⚠️ **注意**: 可能会丢失部分格式信息
- 建议以**表单模式为主**，文档模式为辅
- 切换前会有警告提示

### 3. 编辑大型文档
- 使用标题（H1、H2、H3）组织内容
- 使用表格展示结构化数据
- 定期点击"保存"按钮

### 4. 专业排版
- 使用A4纸张样式（21cm × 29.7cm）
- 保持2cm页边距
- 使用标题层级（H1 > H2 > H3）
- 表格使用清晰的边框

---

## 🎨 样式指南

### 文档结构
```
H1: 文档标题（居中）
    文档编号、版本信息（居中）
    ─────────────────────

H2: 主要章节
    段落内容...
    
    H3: 子章节
        段落内容...
        
        表格:
        ┌─────────┬─────────┐
        │ 字段    │ 值      │
        ├─────────┼─────────┤
        │ 内容    │ 数据    │
        └─────────┴─────────┘
```

### 推荐格式
- **标题**: 使用H1（文档标题）、H2（章节）、H3（子章节）
- **重要信息**: 使用粗体
- **强调**: 使用斜体或颜色
- **数据**: 使用表格
- **分隔**: 使用水平线

---

## ⚠️ 注意事项

### PDF导出
- Windows系统默认不支持直接PDF导出
- **推荐**: 使用浏览器打印功能另存为PDF
- 如需直接导出，需要安装GTK+库

### 图片处理
- 图片需要使用可访问的URL
- 建议先上传图片到服务器
- 大图片可能影响导出速度

### 数据安全
- 定期保存文档
- 重要修改前建议先导出备份
- 切换编辑模式前注意保存

---

## 🐛 常见问题

### Q1: 点击"文档编辑"标签没有反应？
**A**: 检查浏览器控制台是否有错误，确保前端依赖已正确安装。

### Q2: 导出Word失败？
**A**: 检查后端服务是否正常运行，查看后端日志获取详细错误信息。

### Q3: 导出的Word文档格式不正确？
**A**: 确保使用了正确的HTML标签（h1, h2, p, table等），避免使用复杂的CSS样式。

### Q4: 无法插入图片？
**A**: 确保图片URL可访问，建议使用相对路径或已上传到服务器的图片。

### Q5: 保存后刷新页面，内容丢失？
**A**: 检查是否点击了"保存"按钮，查看网络请求是否成功。

---

## 📊 快捷键

| 功能 | Windows/Linux | Mac |
|------|---------------|-----|
| 粗体 | Ctrl+B | Cmd+B |
| 斜体 | Ctrl+I | Cmd+I |
| 下划线 | Ctrl+U | Cmd+U |
| 撤销 | Ctrl+Z | Cmd+Z |
| 重做 | Ctrl+Y | Cmd+Shift+Z |
| 保存 | - | - |

---

## 📚 相关文档

- **快速启动**: `QUICK_START_GUIDE.md`
- **完整文档**: `DOCUMENT_EDITOR_IMPLEMENTATION.md`
- **部署报告**: `DEPLOYMENT_REPORT.md`
- **实施总结**: `IMPLEMENTATION_SUMMARY.md`

---

## 🎯 下一步

### 立即体验
1. ✅ 完成数据库迁移
2. ✅ 启动前后端服务
3. ✅ 打开WPS编辑页面
4. ✅ 切换到文档编辑模式
5. ✅ 开始编辑和导出文档

### 扩展功能（可选）
- [ ] 扩展到PQR系统
- [ ] 扩展到pPQR系统
- [ ] 添加自定义模板
- [ ] 配置协作编辑

---

## 💬 反馈与支持

如有问题或建议，请：
1. 查看相关文档
2. 运行测试脚本: `python test_document_export.py`
3. 检查浏览器控制台和后端日志

---

**最后更新**: 2025-10-27  
**版本**: 1.0.0  
**状态**: ✅ 生产就绪

🎊 祝您使用愉快！


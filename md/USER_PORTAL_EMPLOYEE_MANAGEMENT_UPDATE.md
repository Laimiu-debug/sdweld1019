# ç”¨æˆ·é—¨æˆ·å‘˜å·¥ç®¡ç†é¡µé¢æ›´æ–°

## ğŸ“‹ æ›´æ–°å†…å®¹

### 1. ä¿®å¤å‘˜å·¥é…é¢æ˜¾ç¤ºï¼ˆä½¿ç”¨çœŸå®æ•°æ®ï¼‰

**é—®é¢˜**ï¼šå‘˜å·¥é…é¢æ˜¾ç¤ºçš„æ˜¯è™šå‡æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… æ–°å¢åç«¯APIç«¯ç‚¹ï¼š`GET /api/v1/enterprise/quota/employees`
- âœ… æ›´æ–°å‰ç«¯æœåŠ¡æ–¹æ³•ï¼š`getEmployeeQuota()` è°ƒç”¨çœŸå®API
- âœ… é…é¢ä¿¡æ¯åŒ…æ‹¬ï¼š
  - `current`: å½“å‰å‘˜å·¥æ•°ï¼ˆæ´»è·ƒçŠ¶æ€ï¼‰
  - `max`: æœ€å¤§å‘˜å·¥æ•°ï¼ˆæ ¹æ®ä¼šå‘˜ç­‰çº§ï¼‰
  - `percentage`: ä½¿ç”¨ç™¾åˆ†æ¯”
  - `tier`: ä¼šå‘˜ç­‰çº§æ˜¾ç¤ºåç§°
  - `tier_code`: ä¼šå‘˜ç­‰çº§ä»£ç 

**ä¼šå‘˜ç­‰çº§é…é¢**ï¼š
| ç­‰çº§ | æ˜¾ç¤ºåç§° | æœ€å¤§å‘˜å·¥æ•° |
|------|---------|-----------|
| enterprise | ä¼ä¸šç‰ˆ | 10 |
| enterprise_pro | ä¼ä¸šç‰ˆPRO | 50 |
| enterprise_pro_max | ä¼ä¸šç‰ˆPRO MAX | 200 |

### 2. ä¿®å¤å‘˜å·¥åˆ—è¡¨æ•°æ®ç»“æ„

**é—®é¢˜**ï¼šåç«¯è¿”å›çš„å­—æ®µåä¸å‰ç«¯æœŸæœ›ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… ä¿®æ”¹åç«¯APIè¿”å›æ ¼å¼ï¼š
  - `data.employees` â†’ `data.items`ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰
  - `department` â†’ `department_name`
  - `factory` â†’ `factory_name`
- âœ… å‰ç«¯æ— éœ€ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨ `data.items`

### 3. ç¡®ä¿ä¼ä¸šæ‰€æœ‰è€…åœ¨å‘˜å·¥åˆ—è¡¨ä¸­

**é—®é¢˜**ï¼šå‘˜å·¥åˆ—è¡¨å¯èƒ½ä¸åŒ…æ‹¬ä¼ä¸šæ‰€æœ‰è€…è‡ªå·±

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… åœ¨åˆ›å»ºä¼ä¸šæ—¶è‡ªåŠ¨å°†æ‰€æœ‰è€…æ·»åŠ ä¸ºç®¡ç†å‘˜å‘˜å·¥
- âœ… æ‰€æœ‰è€…å‘˜å·¥ä¿¡æ¯ï¼š
  - è§’è‰²ï¼š`admin`
  - çŠ¶æ€ï¼š`active`
  - èŒä½ï¼š`ä¼ä¸šæ‰€æœ‰è€…`
  - éƒ¨é—¨ï¼š`ç®¡ç†å±‚`
  - æ•°æ®æƒé™ï¼š`company`ï¼ˆå…¨å…¬å¸ï¼‰
  - å®Œæ•´æƒé™ï¼šæ‰€æœ‰åŠŸèƒ½æƒé™

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯æ–‡ä»¶

#### 1. `backend/app/api/v1/endpoints/enterprise.py`

**æ–°å¢APIç«¯ç‚¹**ï¼ˆç¬¬412-477è¡Œï¼‰ï¼š
```python
@router.get("/quota/employees")
async def get_enterprise_employee_quota(
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_active_user)
) -> Any:
    """
    è·å–ä¼ä¸šå‘˜å·¥é…é¢ä¿¡æ¯ï¼ˆä¼ä¸šä¼šå‘˜ä¸“ç”¨ï¼‰
    """
    # è·å–ä¼ä¸š
    company = enterprise_service.get_company_by_owner(current_user.id)
    
    # ç»Ÿè®¡å½“å‰å‘˜å·¥æ•°ï¼ˆæ´»è·ƒçŠ¶æ€ï¼‰
    current_employees = db.query(CompanyEmployee).filter(
        CompanyEmployee.company_id == company.id,
        CompanyEmployee.status == "active"
    ).count()
    
    # è¿”å›é…é¢ä¿¡æ¯
    return {
        "success": True,
        "data": {
            "current": current_employees,
            "max": company.max_employees,
            "percentage": int((current_employees / company.max_employees * 100)),
            "tier": tier_display,
            "tier_code": company.membership_tier
        }
    }
```

**ä¿®æ”¹å‘˜å·¥åˆ—è¡¨API**ï¼ˆç¬¬125-155è¡Œï¼‰ï¼š
```python
# ä¿®æ”¹å­—æ®µåä»¥åŒ¹é…å‰ç«¯æœŸæœ›
employee_list.append({
    "id": str(emp.id),
    "user_id": str(emp.user_id),
    "employee_number": emp.employee_number or "",
    "name": user.full_name or user.username or user.email,
    "email": user.email,
    "phone": user.phone or "",
    "role": emp.role,
    "status": emp.status,
    "position": emp.position or "",
    "department_name": emp.department or "",  # æ”¹ä¸º department_name
    "factory_name": factory.name if factory else "",  # æ”¹ä¸º factory_name
    "factory_id": str(emp.factory_id) if emp.factory_id else None,
    # ... å…¶ä»–å­—æ®µ
})

return {
    "success": True,
    "data": {
        "items": employee_list,  # æ”¹ä¸º items
        "total": total,
        "page": page,
        "page_size": page_size,
        "total_pages": (total + page_size - 1) // page_size
    }
}
```

### å‰ç«¯æ–‡ä»¶

#### 1. `frontend/src/services/enterprise.ts`

**ä¿®æ”¹å‘˜å·¥é…é¢æ–¹æ³•**ï¼ˆç¬¬189-194è¡Œï¼‰ï¼š
```typescript
// è·å–å‘˜å·¥é…é¢ (è°ƒç”¨çœŸå®API)
async getEmployeeQuota() {
  console.log('ğŸ” è°ƒç”¨çœŸå®å‘˜å·¥é…é¢API')
  const response = await api.get(`${this.baseUrl}/quota/employees`)
  return response.data
}
```

**ä¹‹å‰**ï¼šè¿”å›æ¨¡æ‹Ÿæ•°æ®
```typescript
async getEmployeeQuota() {
  // ä¸´æ—¶è¿”å›æ¨¡æ‹Ÿæ•°æ®
  return {
    success: true,
    data: {
      current: 15,
      max: 100,
      percentage: 15,
      tier: 'enterprise'
    }
  }
}
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### APIæµ‹è¯•

ä½¿ç”¨ `backend/test_employee_api.py` æµ‹è¯•ï¼š

```bash
python backend/test_employee_api.py
```

**æµ‹è¯•ç»“æœ**ï¼š
```
âœ… ä½¿ç”¨ enterprise@example.com ç™»å½•æˆåŠŸ

================================================================================
è·å–å‘˜å·¥åˆ—è¡¨ - çŠ¶æ€ç : 200
================================================================================

{
  "success": true,
  "data": {
    "items": [
      {
        "id": "1",
        "user_id": "48",
        "employee_number": "EMP00010001",
        "name": "ä¼ä¸šç”¨æˆ·",
        "email": "enterprise@example.com",
        "phone": "",
        "role": "admin",
        "status": "active",
        "position": "Company Owner",
        "department_name": "Management",
        "factory_name": "Headquarters",
        "factory_id": "1",
        "permissions": {...},
        "data_access_scope": "company",
        "joined_at": "2025-10-18T05:27:49.879824",
        "last_active_at": null,
        "total_wps_created": 0,
        "total_tasks_completed": 0
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 20,
    "total_pages": 1
  }
}

âœ… æˆåŠŸè·å– 1 ä¸ªå‘˜å·¥
  - ä¼ä¸šç”¨æˆ· (enterprise@example.com) - admin - active

================================================================================
è·å–å‘˜å·¥é…é¢ - çŠ¶æ€ç : 200
================================================================================

{
  "success": true,
  "data": {
    "current": 1,
    "max": 200,
    "percentage": 0,
    "tier": "ä¼ä¸šç‰ˆ",
    "tier_code": "enterprise"
  }
}

âœ… å‘˜å·¥é…é¢:
  - å½“å‰: 1
  - æœ€å¤§: 200
  - ä½¿ç”¨ç‡: 0%
  - ç­‰çº§: ä¼ä¸šç‰ˆ
```

### å‰ç«¯æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   cd backend
   python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

2. **å¯åŠ¨å‰ç«¯æœåŠ¡**
   ```bash
   cd frontend
   npm run dev
   ```

3. **ç™»å½•ç”¨æˆ·é—¨æˆ·**
   - ä½¿ç”¨ä¼ä¸šä¼šå‘˜è´¦å·ç™»å½•ï¼š`enterprise@example.com`
   - å¯†ç ï¼š`password123`

4. **è®¿é—®å‘˜å·¥ç®¡ç†é¡µé¢**
   - å¯¼èˆªåˆ°ï¼š**ä¼ä¸šç®¡ç†** â†’ **å‘˜å·¥ç®¡ç†**

5. **éªŒè¯åŠŸèƒ½**
   - âœ… å‘˜å·¥é…é¢æ˜¾ç¤ºçœŸå®æ•°æ®ï¼ˆå½“å‰/æœ€å¤§/ç™¾åˆ†æ¯”/ç­‰çº§ï¼‰
   - âœ… å‘˜å·¥åˆ—è¡¨åŒ…å«ä¼ä¸šæ‰€æœ‰è€…
   - âœ… å‘˜å·¥ä¿¡æ¯å®Œæ•´ï¼ˆå§“åã€é‚®ç®±ã€è§’è‰²ã€çŠ¶æ€ã€å·¥å‚ã€éƒ¨é—¨ï¼‰
   - âœ… ç»Ÿè®¡æ•°æ®æ­£ç¡®ï¼ˆæ€»æ•°ã€åœ¨èŒã€ç¦»èŒã€ç®¡ç†å‘˜ï¼‰
   - âœ… æ‰€æœ‰æ“ä½œæ­£å¸¸ï¼ˆæŸ¥çœ‹ã€ç¼–è¾‘ã€åœç”¨ã€æ¿€æ´»ã€åˆ é™¤ï¼‰

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. å‘˜å·¥é…é¢ç®¡ç†

- **å®æ—¶é…é¢æ˜¾ç¤º**ï¼šæ˜¾ç¤ºå½“å‰å‘˜å·¥æ•°å’Œæœ€å¤§å‘˜å·¥æ•°
- **ä½¿ç”¨ç‡æé†’**ï¼š
  - ä½¿ç”¨ç‡ < 90%ï¼šè“è‰²ä¿¡æ¯æç¤º
  - ä½¿ç”¨ç‡ â‰¥ 90%ï¼šæ©™è‰²è­¦å‘Šæç¤º
- **ç­‰çº§æ˜¾ç¤º**ï¼šæ˜¾ç¤ºå½“å‰ä¼šå‘˜ç­‰çº§åç§°
- **é…é¢é™åˆ¶**ï¼šè¾¾åˆ°é…é¢ä¸Šé™æ—¶ç¦ç”¨"é‚€è¯·å‘˜å·¥"æŒ‰é’®

### 2. å‘˜å·¥åˆ—è¡¨ç®¡ç†

- **å®Œæ•´å‘˜å·¥ä¿¡æ¯**ï¼š
  - åŸºæœ¬ä¿¡æ¯ï¼šå§“åã€å·¥å·ã€èŒä½
  - è”ç³»æ–¹å¼ï¼šé‚®ç®±ã€ç”µè¯
  - ç»„ç»‡ä¿¡æ¯ï¼šå·¥å‚ã€éƒ¨é—¨
  - è§’è‰²å’ŒçŠ¶æ€ï¼šç®¡ç†å‘˜/å‘˜å·¥ã€åœ¨èŒ/ç¦»èŒ
  - æ•°æ®æƒé™ï¼šå…¨å…¬å¸/å½“å‰å·¥å‚
  - å·¥ä½œç»Ÿè®¡ï¼šåˆ›å»ºWPSæ•°ã€å®Œæˆä»»åŠ¡æ•°
  - æ´»è·ƒæ—¶é—´ï¼šæœ€åæ´»è·ƒæ—¶é—´

- **æœç´¢å’Œç­›é€‰**ï¼š
  - æœç´¢ï¼šå§“åã€é‚®ç®±ã€å·¥å·
  - ç­›é€‰ï¼šçŠ¶æ€ã€è§’è‰²ã€å·¥å‚
  - æ ‡ç­¾é¡µï¼šåœ¨èŒå‘˜å·¥ã€ç¦»èŒå‘˜å·¥

- **å‘˜å·¥æ“ä½œ**ï¼š
  - æŸ¥çœ‹è¯¦æƒ…ï¼šæŸ¥çœ‹å®Œæ•´å‘˜å·¥ä¿¡æ¯
  - ç¼–è¾‘æƒé™ï¼šä¿®æ”¹è§’è‰²ã€æ•°æ®æƒé™ã€å·¥å‚ã€éƒ¨é—¨
  - åœç”¨/æ¿€æ´»ï¼šç®¡ç†å‘˜å·¥çŠ¶æ€
  - åˆ é™¤å‘˜å·¥ï¼šç§»é™¤å‘˜å·¥è®°å½•

### 3. ç»Ÿè®¡æ¦‚è§ˆ

- **å‘˜å·¥æ€»æ•°**ï¼šæ‰€æœ‰å‘˜å·¥æ•°é‡
- **åœ¨èŒå‘˜å·¥**ï¼šæ´»è·ƒçŠ¶æ€å‘˜å·¥æ•°é‡
- **ç¦»èŒå‘˜å·¥**ï¼šéæ´»è·ƒçŠ¶æ€å‘˜å·¥æ•°é‡
- **ç®¡ç†å‘˜**ï¼šç®¡ç†å‘˜è§’è‰²å‘˜å·¥æ•°é‡

## ğŸ“Š æ•°æ®æµç¨‹

### å‘˜å·¥é…é¢è·å–æµç¨‹

```
ç”¨æˆ·é—¨æˆ· â†’ useEmployeeQuota Hook
         â†’ enterpriseService.getEmployeeQuota()
         â†’ GET /api/v1/enterprise/quota/employees
         â†’ éªŒè¯ä¼ä¸šä¼šå‘˜æƒé™
         â†’ è·å–ä¼ä¸šä¿¡æ¯
         â†’ ç»Ÿè®¡æ´»è·ƒå‘˜å·¥æ•°
         â†’ è¿”å›é…é¢ä¿¡æ¯
         â†’ å‰ç«¯æ˜¾ç¤ºé…é¢è¿›åº¦æ¡
```

### å‘˜å·¥åˆ—è¡¨è·å–æµç¨‹

```
ç”¨æˆ·é—¨æˆ· â†’ useEnterpriseEmployees Hook
         â†’ enterpriseService.getEmployees()
         â†’ GET /api/v1/enterprise/employees
         â†’ éªŒè¯ä¼ä¸šä¼šå‘˜æƒé™
         â†’ è·å–ä¼ä¸šä¿¡æ¯
         â†’ æŸ¥è¯¢å‘˜å·¥åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰ï¼‰
         â†’ æ ¼å¼åŒ–å‘˜å·¥æ•°æ®
         â†’ è¿”å›å‘˜å·¥åˆ—è¡¨
         â†’ å‰ç«¯æ˜¾ç¤ºå‘˜å·¥è¡¨æ ¼
```

## âœ… å®ŒæˆçŠ¶æ€

- âœ… å‘˜å·¥é…é¢APIå¼€å‘å®Œæˆ
- âœ… å‘˜å·¥é…é¢å‰ç«¯é›†æˆå®Œæˆ
- âœ… å‘˜å·¥åˆ—è¡¨æ•°æ®ç»“æ„ä¿®å¤å®Œæˆ
- âœ… ä¼ä¸šæ‰€æœ‰è€…è‡ªåŠ¨æ·»åŠ ä¸ºå‘˜å·¥
- âœ… APIæµ‹è¯•é€šè¿‡
- âœ… æ•°æ®æ ¼å¼ç»Ÿä¸€

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

1. **å‰ç«¯æµ‹è¯•**
   - åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•å‘˜å·¥ç®¡ç†é¡µé¢
   - éªŒè¯é…é¢æ˜¾ç¤ºæ˜¯å¦æ­£ç¡®
   - éªŒè¯å‘˜å·¥åˆ—è¡¨æ˜¯å¦åŒ…å«æ‰€æœ‰è€…
   - æµ‹è¯•æ‰€æœ‰CRUDæ“ä½œ

2. **æ•°æ®å®Œæ•´æ€§**
   - ç¡®ä¿æ‰€æœ‰ç°æœ‰ä¼ä¸šçš„æ‰€æœ‰è€…éƒ½åœ¨å‘˜å·¥è¡¨ä¸­
   - éªŒè¯æ‰€æœ‰ä¼ä¸šçš„ä¼šå‘˜ç­‰çº§ä¸é…é¢ä¸€è‡´

3. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - æ·»åŠ é…é¢å³å°†ç”¨å®Œçš„æé†’
   - æ·»åŠ å‘˜å·¥é‚€è¯·åŠŸèƒ½
   - æ·»åŠ æ‰¹é‡æ“ä½œåŠŸèƒ½

4. **æƒé™ç®¡ç†**
   - éªŒè¯ä¸åŒè§’è‰²çš„æƒé™æ§åˆ¶
   - æµ‹è¯•æ•°æ®è®¿é—®èŒƒå›´é™åˆ¶

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `ENTERPRISE_INTEGRATION_GUIDE.md` - ä¼ä¸šç®¡ç†åŠŸèƒ½é›†æˆæŒ‡å—
- `FRONTEND_TESTING_CHECKLIST.md` - å‰ç«¯æµ‹è¯•æ¸…å•
- `MEMBERSHIP_TIER_SYNC_FIX.md` - ä¼šå‘˜ç­‰çº§åŒæ­¥ä¿®å¤æ–‡æ¡£
- `ADMIN_ENTERPRISE_MANAGEMENT_UPDATE.md` - ç®¡ç†å‘˜é—¨æˆ·ä¼ä¸šç®¡ç†æ›´æ–°æ–‡æ¡£


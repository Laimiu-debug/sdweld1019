# è®¾å¤‡ç®¡ç†æ¨¡å— - å¼€å‘æŒ‡å—

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### åŠŸèƒ½å®šä½
è®¾å¤‡ç®¡ç†æ¨¡å—ç”¨äºç®¡ç†ç„Šæ¥è®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯ã€ç»´æŠ¤ä¿å…»ã€ä½¿ç”¨è®°å½•å’Œè®¾å¤‡çŠ¶æ€ç›‘æ§ï¼Œç¡®ä¿è®¾å¤‡æ­£å¸¸è¿è¡Œã€‚

### é€‚ç”¨åœºæ™¯
- ç„Šæ¥è®¾å¤‡æ¡£æ¡ˆç®¡ç†
- è®¾å¤‡ç»´æŠ¤ä¿å…»è®¡åˆ’
- è®¾å¤‡ä½¿ç”¨è®°å½•
- è®¾å¤‡çŠ¶æ€ç›‘æ§
- è®¾å¤‡æ•…éšœç®¡ç†
- è®¾å¤‡æ£€å®šæ ¡å‡†

### å¼€å‘ä¼˜å…ˆçº§
**ç¬¬äºŒé˜¶æ®µ** - é‡è¦åŠŸèƒ½ï¼Œä¼˜å…ˆå¼€å‘

---

## ğŸ¯ ä¼šå‘˜æƒé™

### è®¿é—®æƒé™
| ä¼šå‘˜ç­‰çº§ | è®¿é—®æƒé™ | æ•°é‡é™åˆ¶ | åŠŸèƒ½èŒƒå›´ |
|---------|---------|---------|---------|
| æ¸¸å®¢æ¨¡å¼ | âŒ ä¸å¯è®¿é—® | 0 | - |
| ä¸ªäººå…è´¹ç‰ˆ | âŒ ä¸å¯è®¿é—® | 0 | - |
| ä¸ªäººä¸“ä¸šç‰ˆ | âŒ ä¸å¯è®¿é—® | 0 | - |
| ä¸ªäººé«˜çº§ç‰ˆ | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ |
| ä¸ªäººæ——èˆ°ç‰ˆ | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + é«˜çº§ç‰¹æ€§ |
| ä¼ä¸šç‰ˆ | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + ä¼ä¸šåä½œ |
| ä¼ä¸šPRO | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + ä¼ä¸šåä½œ |
| ä¼ä¸šPRO MAX | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + ä¼ä¸šåä½œ |

**é‡è¦è¯´æ˜**: è®¾å¤‡ç®¡ç†åŠŸèƒ½ä»…å¯¹**ä¸ªäººé«˜çº§ç‰ˆåŠä»¥ä¸Š**ä¼šå‘˜å¼€æ”¾ã€‚

### åŠŸèƒ½æƒé™çŸ©é˜µ
| åŠŸèƒ½ | å…è´¹ç‰ˆ | ä¸“ä¸šç‰ˆ | é«˜çº§ç‰ˆ | æ——èˆ°ç‰ˆ | ä¼ä¸šç‰ˆ |
|------|--------|--------|--------|--------|--------|
| è®¾å¤‡åŸºç¡€ç®¡ç† | âŒ | âŒ | âœ… | âœ… | âœ… |
| ç»´æŠ¤ä¿å…»ç®¡ç† | âŒ | âŒ | âœ… | âœ… | âœ… |
| ä½¿ç”¨è®°å½• | âŒ | âŒ | âœ… | âœ… | âœ… |
| æ•…éšœç®¡ç† | âŒ | âŒ | âœ… | âœ… | âœ… |
| æ£€å®šæ ¡å‡† | âŒ | âŒ | âœ… | âœ… | âœ… |
| ç»´æŠ¤æé†’ | âŒ | âŒ | âœ… | âœ… | âœ… |
| ç»Ÿè®¡æŠ¥è¡¨ | âŒ | âŒ | âœ… | âœ… | âœ… |
| è®¾å¤‡ç›‘æ§ | âŒ | âŒ | âŒ | âœ… | âœ… |

---

## ğŸ“Š åŠŸèƒ½æ¸…å•

### 1. è®¾å¤‡åŸºç¡€ç®¡ç†
- **æ·»åŠ è®¾å¤‡**: å½•å…¥è®¾å¤‡åŸºæœ¬ä¿¡æ¯
- **ç¼–è¾‘è®¾å¤‡**: ä¿®æ”¹è®¾å¤‡ä¿¡æ¯
- **åˆ é™¤è®¾å¤‡**: è½¯åˆ é™¤è®¾å¤‡è®°å½•
- **æŸ¥çœ‹è®¾å¤‡**: æŸ¥çœ‹è®¾å¤‡è¯¦ç»†ä¿¡æ¯
- **è®¾å¤‡æ¡£æ¡ˆ**: å®Œæ•´çš„è®¾å¤‡æ¡£æ¡ˆ
- **è®¾å¤‡åˆ†ç±»**: æŒ‰è®¾å¤‡ç±»å‹åˆ†ç±»

### 2. ç»´æŠ¤ä¿å…»ç®¡ç†
- **ç»´æŠ¤è®¡åˆ’**: åˆ¶å®šç»´æŠ¤ä¿å…»è®¡åˆ’
- **ç»´æŠ¤è®°å½•**: è®°å½•ç»´æŠ¤ä¿å…»æƒ…å†µ
- **ç»´æŠ¤æé†’**: åˆ°æœŸæé†’ç»´æŠ¤
- **ç»´æŠ¤å†å²**: æŸ¥çœ‹ç»´æŠ¤å†å²
- **ç»´æŠ¤æˆæœ¬**: è®°å½•ç»´æŠ¤æˆæœ¬
- **é¢„é˜²æ€§ç»´æŠ¤**: é¢„é˜²æ€§ç»´æŠ¤ç®¡ç†

### 3. ä½¿ç”¨è®°å½•
- **ä½¿ç”¨ç™»è®°**: è®°å½•è®¾å¤‡ä½¿ç”¨æƒ…å†µ
- **ä½¿ç”¨æ—¶é•¿**: ç»Ÿè®¡è®¾å¤‡ä½¿ç”¨æ—¶é•¿
- **ä½¿ç”¨äººå‘˜**: è®°å½•ä½¿ç”¨äººå‘˜
- **å…³è”ç”Ÿäº§ä»»åŠ¡**: å…³è”ä½¿ç”¨çš„ç”Ÿäº§ä»»åŠ¡
- **ä½¿ç”¨ç»Ÿè®¡**: è®¾å¤‡ä½¿ç”¨ç»Ÿè®¡åˆ†æ

### 4. æ•…éšœç®¡ç†
- **æ•…éšœæŠ¥å‘Š**: è®°å½•è®¾å¤‡æ•…éšœ
- **æ•…éšœå¤„ç†**: è®°å½•æ•…éšœå¤„ç†è¿‡ç¨‹
- **æ•…éšœåˆ†æ**: æ•…éšœåŸå› åˆ†æ
- **æ•…éšœç»Ÿè®¡**: æ•…éšœç‡ç»Ÿè®¡
- **åœæœºæ—¶é—´**: ç»Ÿè®¡åœæœºæ—¶é—´

### 5. æ£€å®šæ ¡å‡†
- **æ£€å®šè®°å½•**: è®°å½•è®¾å¤‡æ£€å®šæƒ…å†µ
- **æ ¡å‡†è®°å½•**: è®°å½•è®¾å¤‡æ ¡å‡†æƒ…å†µ
- **æ£€å®šè¯ä¹¦**: ä¸Šä¼ æ£€å®šè¯ä¹¦
- **æ£€å®šæé†’**: åˆ°æœŸæé†’æ£€å®š
- **æ£€å®šå†å²**: æŸ¥çœ‹æ£€å®šå†å²

### 6. è®¾å¤‡çŠ¶æ€ç›‘æ§
- **è¿è¡ŒçŠ¶æ€**: å®æ—¶è®¾å¤‡çŠ¶æ€
- **çŠ¶æ€å˜æ›´**: è®°å½•çŠ¶æ€å˜æ›´
- **è®¾å¤‡åˆ©ç”¨ç‡**: è®¡ç®—è®¾å¤‡åˆ©ç”¨ç‡
- **è®¾å¤‡æ•ˆç‡**: åˆ†æè®¾å¤‡æ•ˆç‡

### 7. ç»Ÿè®¡åˆ†æ
- **è®¾å¤‡ç»Ÿè®¡**: æŒ‰çŠ¶æ€ã€ç±»å‹ç»Ÿè®¡
- **ç»´æŠ¤ç»Ÿè®¡**: ç»´æŠ¤æ¬¡æ•°ã€æˆæœ¬ç»Ÿè®¡
- **æ•…éšœç»Ÿè®¡**: æ•…éšœç‡ã€åœæœºæ—¶é—´ç»Ÿè®¡
- **ä½¿ç”¨ç»Ÿè®¡**: ä½¿ç”¨æ—¶é•¿ã€åˆ©ç”¨ç‡ç»Ÿè®¡

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### è®¾å¤‡åŸºæœ¬ä¿¡æ¯è¡¨
```sql
CREATE TABLE equipment (
    -- ä¸»é”®å’ŒåŸºç¡€å­—æ®µ
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    company_id UUID REFERENCES companies(id) ON DELETE CASCADE,
    factory_id UUID REFERENCES factories(id) ON DELETE SET NULL,
    
    -- åŸºæœ¬ä¿¡æ¯
    equipment_code VARCHAR(100) NOT NULL,          -- è®¾å¤‡ç¼–å·
    equipment_name VARCHAR(255) NOT NULL,          -- è®¾å¤‡åç§°
    equipment_type VARCHAR(100),                   -- è®¾å¤‡ç±»å‹: welding_machine, cutting_machine, etc.
    model VARCHAR(100),                            -- å‹å·
    manufacturer VARCHAR(255),                     -- åˆ¶é€ å•†
    serial_number VARCHAR(100),                    -- åºåˆ—å·
    
    -- æŠ€æœ¯å‚æ•°
    rated_power DECIMAL(10,2),                    -- é¢å®šåŠŸç‡ (kW)
    rated_current DECIMAL(10,2),                  -- é¢å®šç”µæµ (A)
    rated_voltage DECIMAL(10,2),                  -- é¢å®šç”µå‹ (V)
    welding_process VARCHAR(100),                  -- é€‚ç”¨ç„Šæ¥æ–¹æ³•
    technical_specs JSONB,                         -- æŠ€æœ¯è§„æ ¼
    
    -- é‡‡è´­ä¿¡æ¯
    purchase_date DATE,                            -- é‡‡è´­æ—¥æœŸ
    purchase_price DECIMAL(15,2),                 -- é‡‡è´­ä»·æ ¼
    supplier VARCHAR(255),                         -- ä¾›åº”å•†
    warranty_period INTEGER,                       -- ä¿ä¿®æœŸï¼ˆæœˆï¼‰
    warranty_expiry_date DATE,                     -- ä¿ä¿®åˆ°æœŸæ—¥æœŸ
    
    -- çŠ¶æ€ä¿¡æ¯
    status VARCHAR(50) DEFAULT 'operational',      -- çŠ¶æ€: operational, maintenance, fault, retired
    location VARCHAR(255),                         -- å­˜æ”¾ä½ç½®
    responsible_person_id UUID REFERENCES users(id), -- è´£ä»»äºº
    
    -- ç»´æŠ¤ä¿¡æ¯
    last_maintenance_date DATE,                    -- ä¸Šæ¬¡ç»´æŠ¤æ—¥æœŸ
    next_maintenance_date DATE,                    -- ä¸‹æ¬¡ç»´æŠ¤æ—¥æœŸ
    maintenance_interval_days INTEGER DEFAULT 90, -- ç»´æŠ¤é—´éš”ï¼ˆå¤©ï¼‰
    
    -- æ£€å®šä¿¡æ¯
    last_calibration_date DATE,                    -- ä¸Šæ¬¡æ£€å®šæ—¥æœŸ
    next_calibration_date DATE,                    -- ä¸‹æ¬¡æ£€å®šæ—¥æœŸ
    calibration_interval_days INTEGER DEFAULT 365, -- æ£€å®šé—´éš”ï¼ˆå¤©ï¼‰
    calibration_certificate JSONB,                 -- æ£€å®šè¯ä¹¦
    
    -- ç»Ÿè®¡ä¿¡æ¯
    total_usage_hours DECIMAL(12,2) DEFAULT 0,    -- æ€»ä½¿ç”¨æ—¶é•¿ï¼ˆå°æ—¶ï¼‰
    total_maintenance_count INTEGER DEFAULT 0,     -- æ€»ç»´æŠ¤æ¬¡æ•°
    total_fault_count INTEGER DEFAULT 0,           -- æ€»æ•…éšœæ¬¡æ•°
    
    -- é™„ä»¶
    photos JSONB,                                  -- è®¾å¤‡ç…§ç‰‡
    manuals JSONB,                                 -- ä½¿ç”¨æ‰‹å†Œ
    attachments JSONB,                             -- å…¶ä»–é™„ä»¶
    
    -- å¤‡æ³¨
    notes TEXT,
    tags JSONB,
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    updated_by UUID REFERENCES users(id),
    deleted_at TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_user (user_id),
    INDEX idx_company (company_id),
    INDEX idx_factory (factory_id),
    INDEX idx_equipment_code (equipment_code),
    INDEX idx_equipment_type (equipment_type),
    INDEX idx_status (status),
    INDEX idx_next_maintenance (next_maintenance_date),
    INDEX idx_next_calibration (next_calibration_date),
    INDEX idx_deleted (deleted_at),
    
    UNIQUE (user_id, equipment_code)
);
```

### è®¾å¤‡ç»´æŠ¤è®°å½•è¡¨
```sql
CREATE TABLE equipment_maintenance (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    equipment_id UUID NOT NULL REFERENCES equipment(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- ç»´æŠ¤ä¿¡æ¯
    maintenance_type VARCHAR(50),                  -- ç»´æŠ¤ç±»å‹: routine, preventive, corrective
    maintenance_date DATE NOT NULL,                -- ç»´æŠ¤æ—¥æœŸ
    maintenance_description TEXT,                  -- ç»´æŠ¤å†…å®¹
    
    -- ç»´æŠ¤äººå‘˜
    technician_id UUID REFERENCES users(id),       -- ç»´æŠ¤äººå‘˜
    technician_name VARCHAR(100),                  -- ç»´æŠ¤äººå‘˜å§“å
    
    -- ç»´æŠ¤ç»“æœ
    maintenance_result VARCHAR(50),                -- ç»´æŠ¤ç»“æœ: completed, pending, failed
    issues_found TEXT,                             -- å‘ç°çš„é—®é¢˜
    actions_taken TEXT,                            -- é‡‡å–çš„æªæ–½
    
    -- æˆæœ¬
    labor_cost DECIMAL(12,2),                     -- äººå·¥æˆæœ¬
    parts_cost DECIMAL(12,2),                     -- é…ä»¶æˆæœ¬
    total_cost DECIMAL(12,2),                     -- æ€»æˆæœ¬
    
    -- åœæœºæ—¶é—´
    downtime_hours DECIMAL(8,2),                  -- åœæœºæ—¶é•¿ï¼ˆå°æ—¶ï¼‰
    
    -- ä¸‹æ¬¡ç»´æŠ¤
    next_maintenance_date DATE,                    -- ä¸‹æ¬¡ç»´æŠ¤æ—¥æœŸ
    
    -- é™„ä»¶
    maintenance_photos JSONB,                      -- ç»´æŠ¤ç…§ç‰‡
    maintenance_report JSONB,                      -- ç»´æŠ¤æŠ¥å‘Š
    
    -- å¤‡æ³¨
    notes TEXT,
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    
    -- ç´¢å¼•
    INDEX idx_equipment (equipment_id),
    INDEX idx_user (user_id),
    INDEX idx_maintenance_date (maintenance_date),
    INDEX idx_maintenance_type (maintenance_type)
);
```

### è®¾å¤‡ä½¿ç”¨è®°å½•è¡¨
```sql
CREATE TABLE equipment_usage (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    equipment_id UUID NOT NULL REFERENCES equipment(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- ä½¿ç”¨ä¿¡æ¯
    usage_date DATE NOT NULL,                      -- ä½¿ç”¨æ—¥æœŸ
    start_time TIMESTAMP,                          -- å¼€å§‹æ—¶é—´
    end_time TIMESTAMP,                            -- ç»“æŸæ—¶é—´
    usage_hours DECIMAL(8,2),                     -- ä½¿ç”¨æ—¶é•¿ï¼ˆå°æ—¶ï¼‰
    
    -- ä½¿ç”¨äººå‘˜
    operator_id UUID REFERENCES users(id),         -- æ“ä½œäººå‘˜
    operator_name VARCHAR(100),                    -- æ“ä½œäººå‘˜å§“å
    
    -- å…³è”ä¿¡æ¯
    production_task_id UUID REFERENCES production_tasks(id),
    wps_id UUID REFERENCES wps_records(id),
    
    -- ä½¿ç”¨æƒ…å†µ
    usage_description TEXT,                        -- ä½¿ç”¨è¯´æ˜
    equipment_condition VARCHAR(50),               -- è®¾å¤‡çŠ¶å†µ: good, normal, poor
    
    -- å¤‡æ³¨
    notes TEXT,
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    
    -- ç´¢å¼•
    INDEX idx_equipment (equipment_id),
    INDEX idx_user (user_id),
    INDEX idx_usage_date (usage_date),
    INDEX idx_operator (operator_id),
    INDEX idx_production_task (production_task_id)
);
```

---

## ğŸ”Œ APIæ¥å£

### 1. è®¾å¤‡åˆ—è¡¨
```http
GET /api/v1/equipment?page=1&page_size=20&status=operational
Authorization: Bearer <token>
```

### 2. åˆ›å»ºè®¾å¤‡
```http
POST /api/v1/equipment
Authorization: Bearer <token>
Content-Type: application/json

{
  "equipment_code": "EQ-2025-001",
  "equipment_name": "ç„Šæ¥æœºå™¨äºº",
  "equipment_type": "welding_machine",
  "model": "ABB IRB 1600",
  "manufacturer": "ABB",
  "purchase_date": "2025-01-01",
  "maintenance_interval_days": 90
}
```

### 3. æ·»åŠ ç»´æŠ¤è®°å½•
```http
POST /api/v1/equipment/{id}/maintenance
Authorization: Bearer <token>
Content-Type: application/json

{
  "maintenance_type": "routine",
  "maintenance_date": "2025-10-15",
  "maintenance_description": "å®šæœŸä¿å…»",
  "technician_id": "uuid",
  "total_cost": 500,
  "next_maintenance_date": "2026-01-15"
}
```

### 4. è·å–ç»´æŠ¤æé†’
```http
GET /api/v1/equipment/maintenance-alerts?days=30
Authorization: Bearer <token>
```

### 5. è®¾å¤‡ç»Ÿè®¡
```http
GET /api/v1/equipment/statistics
Authorization: Bearer <token>
```

---

## ğŸ’¼ ä¸šåŠ¡é€»è¾‘

### 1. ç»´æŠ¤æé†’æ£€æŸ¥
```python
class EquipmentService:
    def get_maintenance_alerts(
        self,
        user_id: UUID,
        days: int,
        db: Session
    ) -> List[Equipment]:
        """è·å–éœ€è¦ç»´æŠ¤çš„è®¾å¤‡"""
        
        alert_date = date.today() + timedelta(days=days)
        
        equipment_list = db.query(Equipment).filter(
            Equipment.user_id == user_id,
            Equipment.status == "operational",
            Equipment.next_maintenance_date <= alert_date,
            Equipment.next_maintenance_date >= date.today(),
            Equipment.deleted_at.is_(None)
        ).all()
        
        return equipment_list
```

### 2. ä½¿ç”¨æ—¶é•¿ç»Ÿè®¡
```python
def record_usage(
    self,
    equipment_id: UUID,
    usage_data: EquipmentUsage,
    user_id: UUID,
    db: Session
) -> Equipment:
    """è®°å½•è®¾å¤‡ä½¿ç”¨"""
    
    equipment = db.query(Equipment).filter(
        Equipment.id == equipment_id,
        Equipment.user_id == user_id
    ).first()
    
    if not equipment:
        raise HTTPException(404, "è®¾å¤‡ä¸å­˜åœ¨")
    
    # è®¡ç®—ä½¿ç”¨æ—¶é•¿
    if usage_data.start_time and usage_data.end_time:
        duration = (usage_data.end_time - usage_data.start_time).total_seconds() / 3600
        usage_data.usage_hours = round(duration, 2)
    
    # åˆ›å»ºä½¿ç”¨è®°å½•
    usage = EquipmentUsage(
        **usage_data.dict(),
        equipment_id=equipment_id,
        user_id=user_id,
        created_by=user_id
    )
    
    db.add(usage)
    
    # æ›´æ–°è®¾å¤‡æ€»ä½¿ç”¨æ—¶é•¿
    equipment.total_usage_hours += usage_data.usage_hours
    equipment.updated_at = datetime.now()
    
    db.commit()
    
    return equipment
```

---

## ğŸ” æƒé™æ§åˆ¶

```python
@router.get("/equipment")
@require_feature("equipment_management")  # éœ€è¦é«˜çº§ç‰ˆåŠä»¥ä¸Š
async def get_equipment_list(
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """è·å–è®¾å¤‡åˆ—è¡¨"""
    service = EquipmentService(db)
    return service.get_equipment_list(current_user.id, db)
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢

### è®¾å¤‡åˆ—è¡¨é¡µé¢
```typescript
// src/pages/Equipment/List.tsx

const EquipmentList: React.FC = () => {
  const { data, loading } = useEquipment();
  
  const columns = [
    { title: 'è®¾å¤‡ç¼–å·', dataIndex: 'equipment_code' },
    { title: 'è®¾å¤‡åç§°', dataIndex: 'equipment_name' },
    { title: 'å‹å·', dataIndex: 'model' },
    { title: 'çŠ¶æ€', dataIndex: 'status', render: renderStatus },
    { title: 'ä¸‹æ¬¡ç»´æŠ¤', dataIndex: 'next_maintenance_date' },
    { title: 'æ“ä½œ', render: renderActions }
  ];
  
  return (
    <div>
      <Table columns={columns} dataSource={data} loading={loading} />
    </div>
  );
};
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-16  
**å¼€å‘çŠ¶æ€**: å·²å®ç°ï¼ˆéœ€æµ‹è¯•ï¼‰


# ç®¡ç†å‘˜é—¨æˆ·æ¨¡å— - å¼€å‘æŒ‡å—

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### åŠŸèƒ½å®šä½
ç®¡ç†å‘˜é—¨æˆ·æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä¸“ç”¨çš„åå°ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç†æ‰€æœ‰ç”¨æˆ·ã€ç›‘æ§ç³»ç»Ÿè¿è¡Œã€å¤„ç†ç³»ç»Ÿé…ç½®ç­‰ç®¡ç†ä»»åŠ¡ã€‚

### é€‚ç”¨åœºæ™¯
- ç”¨æˆ·ç®¡ç†å’Œå®¡æ ¸
- ç³»ç»Ÿç›‘æ§å’Œç»´æŠ¤
- æ•°æ®ç»Ÿè®¡å’Œåˆ†æ
- ç³»ç»Ÿé…ç½®ç®¡ç†
- å†…å®¹å®¡æ ¸
- æ—¥å¿—æŸ¥çœ‹

### å¼€å‘ä¼˜å…ˆçº§
**ç¬¬ä¸‰é˜¶æ®µ** - ç®¡ç†åŠŸèƒ½ï¼Œåç»­å¼€å‘

---

## ğŸ¯ è®¿é—®æƒé™

### æƒé™è¦æ±‚
- **å¿…é¡»æ¡ä»¶**: `is_admin = true`
- **è®¿é—®çº§åˆ«**: è¶…çº§ç®¡ç†å‘˜
- **ç‹¬ç«‹ç³»ç»Ÿ**: ä¸ç”¨æˆ·é—¨æˆ·å®Œå…¨åˆ†ç¦»

**é‡è¦è¯´æ˜**: 
- ç®¡ç†å‘˜é—¨æˆ·æ˜¯ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œéœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™
- æ™®é€šç”¨æˆ·ï¼ˆåŒ…æ‹¬ä¼ä¸šç®¡ç†å‘˜ï¼‰æ— æ³•è®¿é—®
- ç®¡ç†å‘˜è´¦å·ç”±ç³»ç»Ÿåˆå§‹åŒ–æ—¶åˆ›å»º

---

## ğŸ“Š åŠŸèƒ½æ¸…å•

### 1. ç”¨æˆ·ç®¡ç†
- **ç”¨æˆ·åˆ—è¡¨**: æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
- **ç”¨æˆ·è¯¦æƒ…**: æŸ¥çœ‹ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
- **ç”¨æˆ·æœç´¢**: æœç´¢ç”¨æˆ·
- **ç”¨æˆ·å®¡æ ¸**: å®¡æ ¸ç”¨æˆ·æ³¨å†Œ
- **ç”¨æˆ·ç¦ç”¨**: ç¦ç”¨/å¯ç”¨ç”¨æˆ·
- **ç”¨æˆ·åˆ é™¤**: åˆ é™¤ç”¨æˆ·è´¦å·
- **ä¼šå‘˜è°ƒæ•´**: è°ƒæ•´ç”¨æˆ·ä¼šå‘˜ç­‰çº§
- **é…é¢è°ƒæ•´**: è°ƒæ•´ç”¨æˆ·é…é¢

### 2. ä¼ä¸šç®¡ç†
- **ä¼ä¸šåˆ—è¡¨**: æŸ¥çœ‹æ‰€æœ‰ä¼ä¸š
- **ä¼ä¸šå®¡æ ¸**: å®¡æ ¸ä¼ä¸šè®¤è¯
- **ä¼ä¸šè¯¦æƒ…**: æŸ¥çœ‹ä¼ä¸šè¯¦ç»†ä¿¡æ¯
- **ä¼ä¸šç¦ç”¨**: ç¦ç”¨/å¯ç”¨ä¼ä¸š
- **ä¼ä¸šç»Ÿè®¡**: ä¼ä¸šæ•°æ®ç»Ÿè®¡

### 3. è®¢é˜…ç®¡ç†
- **è®¢é˜…åˆ—è¡¨**: æŸ¥çœ‹æ‰€æœ‰è®¢é˜…
- **è®¢é˜…è¯¦æƒ…**: æŸ¥çœ‹è®¢é˜…è¯¦ç»†ä¿¡æ¯
- **è®¢é˜…è°ƒæ•´**: æ‰‹åŠ¨è°ƒæ•´è®¢é˜…
- **é€€æ¬¾å¤„ç†**: å¤„ç†é€€æ¬¾è¯·æ±‚
- **å‘ç¥¨ç®¡ç†**: ç®¡ç†å‘ç¥¨

### 4. ç³»ç»Ÿç›‘æ§
- **ç³»ç»ŸçŠ¶æ€**: æŸ¥çœ‹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
- **æ€§èƒ½ç›‘æ§**: ç›‘æ§ç³»ç»Ÿæ€§èƒ½
- **é”™è¯¯æ—¥å¿—**: æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- **è®¿é—®æ—¥å¿—**: æŸ¥çœ‹è®¿é—®æ—¥å¿—
- **æ•°æ®åº“ç›‘æ§**: ç›‘æ§æ•°æ®åº“çŠ¶æ€
- **API ç›‘æ§**: ç›‘æ§ API è°ƒç”¨

### 5. æ•°æ®ç»Ÿè®¡
- **ç”¨æˆ·ç»Ÿè®¡**: ç”¨æˆ·å¢é•¿ã€æ´»è·ƒåº¦ç»Ÿè®¡
- **è®¢é˜…ç»Ÿè®¡**: è®¢é˜…è½¬åŒ–ç‡ã€æ”¶å…¥ç»Ÿè®¡
- **ä½¿ç”¨ç»Ÿè®¡**: åŠŸèƒ½ä½¿ç”¨ç»Ÿè®¡
- **æ€§èƒ½ç»Ÿè®¡**: ç³»ç»Ÿæ€§èƒ½ç»Ÿè®¡
- **è¶‹åŠ¿åˆ†æ**: å„ç±»è¶‹åŠ¿åˆ†æ

### 6. å†…å®¹ç®¡ç†
- **å…¬å‘Šç®¡ç†**: å‘å¸ƒç³»ç»Ÿå…¬å‘Š
- **å¸®åŠ©æ–‡æ¡£**: ç®¡ç†å¸®åŠ©æ–‡æ¡£
- **FAQ ç®¡ç†**: ç®¡ç†å¸¸è§é—®é¢˜
- **æ¨¡æ¿ç®¡ç†**: ç®¡ç†ç³»ç»Ÿæ¨¡æ¿

### 7. ç³»ç»Ÿé…ç½®
- **åŸºç¡€é…ç½®**: ç³»ç»ŸåŸºç¡€é…ç½®
- **ä¼šå‘˜é…ç½®**: ä¼šå‘˜ç­‰çº§é…ç½®
- **åŠŸèƒ½å¼€å…³**: åŠŸèƒ½å¼€å…³ç®¡ç†
- **å‚æ•°é…ç½®**: ç³»ç»Ÿå‚æ•°é…ç½®
- **é‚®ä»¶é…ç½®**: é‚®ä»¶æœåŠ¡é…ç½®
- **å­˜å‚¨é…ç½®**: å­˜å‚¨æœåŠ¡é…ç½®

### 8. å®‰å…¨ç®¡ç†
- **æƒé™ç®¡ç†**: ç®¡ç†å‘˜æƒé™ç®¡ç†
- **IP ç™½åå•**: IP è®¿é—®æ§åˆ¶
- **å®‰å…¨æ—¥å¿—**: æŸ¥çœ‹å®‰å…¨æ—¥å¿—
- **å¼‚å¸¸æ£€æµ‹**: æ£€æµ‹å¼‚å¸¸è¡Œä¸º

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### ç®¡ç†å‘˜è¡¨
```sql
CREATE TABLE admins (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- ç®¡ç†å‘˜ä¿¡æ¯
    admin_level VARCHAR(20) DEFAULT 'admin',       -- çº§åˆ«: super_admin, admin
    permissions JSONB,                             -- æƒé™åˆ—è¡¨
    
    -- çŠ¶æ€
    is_active BOOLEAN DEFAULT TRUE,                -- æ˜¯å¦æ´»è·ƒ
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    
    -- ç´¢å¼•
    INDEX idx_user (user_id),
    INDEX idx_admin_level (admin_level),
    
    UNIQUE (user_id)
);
```

### ç³»ç»Ÿå…¬å‘Šè¡¨
```sql
CREATE TABLE system_announcements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- å…¬å‘Šä¿¡æ¯
    title VARCHAR(255) NOT NULL,                   -- æ ‡é¢˜
    content TEXT NOT NULL,                         -- å†…å®¹
    announcement_type VARCHAR(50),                 -- ç±»å‹: info, warning, maintenance
    priority VARCHAR(20) DEFAULT 'normal',         -- ä¼˜å…ˆçº§
    
    -- æ˜¾ç¤ºè®¾ç½®
    is_published BOOLEAN DEFAULT FALSE,            -- æ˜¯å¦å‘å¸ƒ
    is_pinned BOOLEAN DEFAULT FALSE,               -- æ˜¯å¦ç½®é¡¶
    target_audience VARCHAR(50) DEFAULT 'all',     -- ç›®æ ‡å—ä¼—: all, free, pro, enterprise
    
    -- æ—¶é—´è®¾ç½®
    publish_at TIMESTAMP,                          -- å‘å¸ƒæ—¶é—´
    expire_at TIMESTAMP,                           -- è¿‡æœŸæ—¶é—´
    
    -- ç»Ÿè®¡
    view_count INTEGER DEFAULT 0,                  -- æŸ¥çœ‹æ¬¡æ•°
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    updated_by UUID REFERENCES users(id),
    
    -- ç´¢å¼•
    INDEX idx_is_published (is_published),
    INDEX idx_publish_at (publish_at),
    INDEX idx_expire_at (expire_at)
);
```

### ç³»ç»Ÿæ—¥å¿—è¡¨
```sql
CREATE TABLE system_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- æ—¥å¿—ä¿¡æ¯
    log_level VARCHAR(20),                         -- çº§åˆ«: debug, info, warning, error, critical
    log_type VARCHAR(50),                          -- ç±»å‹: api, database, security, system
    message TEXT,                                  -- æ¶ˆæ¯
    details JSONB,                                 -- è¯¦ç»†ä¿¡æ¯
    
    -- æ¥æºä¿¡æ¯
    user_id UUID REFERENCES users(id),             -- ç”¨æˆ·ID
    ip_address VARCHAR(50),                        -- IP åœ°å€
    user_agent TEXT,                               -- æµè§ˆå™¨ä¿¡æ¯
    
    -- è¯·æ±‚ä¿¡æ¯
    request_method VARCHAR(10),                    -- è¯·æ±‚æ–¹æ³•
    request_path VARCHAR(500),                     -- è¯·æ±‚è·¯å¾„
    request_params JSONB,                          -- è¯·æ±‚å‚æ•°
    response_status INTEGER,                       -- å“åº”çŠ¶æ€ç 
    response_time DECIMAL(10,3),                  -- å“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    
    -- é”™è¯¯ä¿¡æ¯
    error_message TEXT,                            -- é”™è¯¯æ¶ˆæ¯
    stack_trace TEXT,                              -- å †æ ˆè·Ÿè¸ª
    
    -- æ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_log_level (log_level),
    INDEX idx_log_type (log_type),
    INDEX idx_user (user_id),
    INDEX idx_created_at (created_at)
);
```

---

## ğŸ”Œ APIæ¥å£

### 1. ç”¨æˆ·ç®¡ç†

#### è·å–ç”¨æˆ·åˆ—è¡¨
```http
GET /api/v1/admin/users?page=1&page_size=20&membership_tier=pro
Authorization: Bearer <admin_token>
```

#### è·å–ç”¨æˆ·è¯¦æƒ…
```http
GET /api/v1/admin/users/{user_id}
Authorization: Bearer <admin_token>
```

#### è°ƒæ•´ç”¨æˆ·ä¼šå‘˜
```http
POST /api/v1/admin/users/{user_id}/adjust-membership
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "membership_tier": "enterprise",
  "expires_at": "2026-10-16",
  "reason": "ç‰¹æ®Šç”³è¯·æ‰¹å‡†"
}
```

#### ç¦ç”¨ç”¨æˆ·
```http
POST /api/v1/admin/users/{user_id}/disable
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "reason": "è¿åæœåŠ¡æ¡æ¬¾"
}
```

### 2. ç³»ç»Ÿç›‘æ§

#### è·å–ç³»ç»ŸçŠ¶æ€
```http
GET /api/v1/admin/system/status
Authorization: Bearer <admin_token>
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "uptime_seconds": 86400,
    "cpu_usage": 45.2,
    "memory_usage": 62.8,
    "disk_usage": 38.5,
    "database_status": "connected",
    "redis_status": "connected",
    "active_users": 150,
    "api_requests_per_minute": 320
  }
}
```

#### è·å–é”™è¯¯æ—¥å¿—
```http
GET /api/v1/admin/logs/errors?page=1&page_size=50&level=error
Authorization: Bearer <admin_token>
```

### 3. æ•°æ®ç»Ÿè®¡

#### è·å–ç”¨æˆ·ç»Ÿè®¡
```http
GET /api/v1/admin/statistics/users?start_date=2025-09-01&end_date=2025-10-16
Authorization: Bearer <admin_token>
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "total_users": 1500,
    "new_users": 150,
    "active_users": 800,
    "by_tier": {
      "free": 800,
      "pro": 400,
      "advanced": 200,
      "flagship": 50,
      "enterprise": 50
    },
    "growth_rate": 11.1,
    "trend": [
      {"date": "2025-09-01", "count": 1350},
      {"date": "2025-10-01", "count": 1450}
    ]
  }
}
```

#### è·å–è®¢é˜…ç»Ÿè®¡
```http
GET /api/v1/admin/statistics/subscriptions?start_date=2025-09-01&end_date=2025-10-16
Authorization: Bearer <admin_token>
```

### 4. ç³»ç»Ÿé…ç½®

#### è·å–ç³»ç»Ÿé…ç½®
```http
GET /api/v1/admin/config
Authorization: Bearer <admin_token>
```

#### æ›´æ–°ç³»ç»Ÿé…ç½®
```http
PUT /api/v1/admin/config
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "maintenance_mode": false,
  "registration_enabled": true,
  "max_upload_size_mb": 100,
  "session_timeout_minutes": 60
}
```

### 5. å…¬å‘Šç®¡ç†

#### åˆ›å»ºå…¬å‘Š
```http
POST /api/v1/admin/announcements
Authorization: Bearer <admin_token>
Content-Type: application/json

{
  "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥",
  "content": "ç³»ç»Ÿå°†äºæœ¬å‘¨å…­è¿›è¡Œç»´æŠ¤...",
  "announcement_type": "maintenance",
  "priority": "high",
  "target_audience": "all",
  "publish_at": "2025-10-17T00:00:00Z",
  "expire_at": "2025-10-20T00:00:00Z"
}
```

#### å‘å¸ƒå…¬å‘Š
```http
POST /api/v1/admin/announcements/{id}/publish
Authorization: Bearer <admin_token>
```

---

## ğŸ’¼ ä¸šåŠ¡é€»è¾‘

### 1. ç”¨æˆ·ç®¡ç†
```python
class AdminService:
    def get_user_list(
        self,
        filters: Dict,
        page: int,
        page_size: int,
        db: Session
    ) -> Dict[str, Any]:
        """è·å–ç”¨æˆ·åˆ—è¡¨"""
        
        query = db.query(User)
        
        # åº”ç”¨ç­›é€‰
        if filters.get("membership_tier"):
            query = query.filter(User.membership_tier == filters["membership_tier"])
        
        if filters.get("membership_type"):
            query = query.filter(User.membership_type == filters["membership_type"])
        
        if filters.get("is_active") is not None:
            query = query.filter(User.is_active == filters["is_active"])
        
        # åˆ†é¡µ
        total = query.count()
        users = query.offset((page - 1) * page_size).limit(page_size).all()
        
        return {
            "items": users,
            "total": total,
            "page": page,
            "page_size": page_size,
            "total_pages": (total + page_size - 1) // page_size
        }
    
    def adjust_user_membership(
        self,
        user_id: UUID,
        adjustment_data: MembershipAdjustment,
        admin_id: UUID,
        db: Session
    ) -> User:
        """è°ƒæ•´ç”¨æˆ·ä¼šå‘˜ç­‰çº§"""
        
        user = db.query(User).filter(User.id == user_id).first()
        
        if not user:
            raise HTTPException(404, "ç”¨æˆ·ä¸å­˜åœ¨")
        
        # è®°å½•è°ƒæ•´å‰çš„çŠ¶æ€
        old_tier = user.membership_tier
        
        # æ›´æ–°ä¼šå‘˜ç­‰çº§
        user.membership_tier = adjustment_data.membership_tier
        user.subscription_expires_at = adjustment_data.expires_at
        user.updated_at = datetime.now()
        
        db.commit()
        
        # è®°å½•æ“ä½œæ—¥å¿—
        self._log_admin_action(
            admin_id,
            "adjust_membership",
            f"è°ƒæ•´ç”¨æˆ· {user.email} ä¼šå‘˜ç­‰çº§ä» {old_tier} åˆ° {adjustment_data.membership_tier}",
            {"user_id": str(user_id), "reason": adjustment_data.reason},
            db
        )
        
        return user
```

### 2. ç³»ç»Ÿç›‘æ§
```python
def get_system_status(self) -> Dict[str, Any]:
    """è·å–ç³»ç»ŸçŠ¶æ€"""
    
    import psutil
    
    # CPU ä½¿ç”¨ç‡
    cpu_usage = psutil.cpu_percent(interval=1)
    
    # å†…å­˜ä½¿ç”¨ç‡
    memory = psutil.virtual_memory()
    memory_usage = memory.percent
    
    # ç£ç›˜ä½¿ç”¨ç‡
    disk = psutil.disk_usage('/')
    disk_usage = disk.percent
    
    # ç³»ç»Ÿè¿è¡Œæ—¶é—´
    uptime_seconds = time.time() - psutil.boot_time()
    
    return {
        "status": "healthy",
        "uptime_seconds": int(uptime_seconds),
        "cpu_usage": cpu_usage,
        "memory_usage": memory_usage,
        "disk_usage": disk_usage,
        "database_status": self._check_database_status(),
        "redis_status": self._check_redis_status()
    }
```

### 3. æ•°æ®ç»Ÿè®¡
```python
def get_user_statistics(
    self,
    start_date: date,
    end_date: date,
    db: Session
) -> Dict[str, Any]:
    """è·å–ç”¨æˆ·ç»Ÿè®¡"""
    
    # æ€»ç”¨æˆ·æ•°
    total_users = db.query(User).count()
    
    # æ–°å¢ç”¨æˆ·
    new_users = db.query(User).filter(
        User.created_at >= start_date,
        User.created_at <= end_date
    ).count()
    
    # æ´»è·ƒç”¨æˆ·ï¼ˆæœ€è¿‘30å¤©æœ‰ç™»å½•ï¼‰
    active_users = db.query(User).filter(
        User.last_login_at >= datetime.now() - timedelta(days=30)
    ).count()
    
    # æŒ‰ä¼šå‘˜ç­‰çº§ç»Ÿè®¡
    by_tier = db.query(
        User.membership_tier,
        func.count(User.id)
    ).group_by(User.membership_tier).all()
    
    return {
        "total_users": total_users,
        "new_users": new_users,
        "active_users": active_users,
        "by_tier": dict(by_tier),
        "growth_rate": round(new_users / total_users * 100, 2) if total_users > 0 else 0
    }
```

---

## ğŸ” æƒé™æ§åˆ¶

### ç®¡ç†å‘˜æƒé™æ£€æŸ¥
```python
def require_admin(
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """è¦æ±‚ç®¡ç†å‘˜æƒé™"""
    
    if not current_user.is_admin:
        raise HTTPException(403, "éœ€è¦ç®¡ç†å‘˜æƒé™")
    
    admin = db.query(Admin).filter(
        Admin.user_id == current_user.id,
        Admin.is_active == True
    ).first()
    
    if not admin:
        raise HTTPException(403, "ç®¡ç†å‘˜è´¦å·æœªæ¿€æ´»")
    
    return current_user

@router.get("/admin/users")
async def get_users(
    page: int = 1,
    page_size: int = 20,
    current_admin: User = Depends(require_admin),
    db: Session = Depends(get_db)
):
    """è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰"""
    service = AdminService(db)
    return service.get_user_list({}, page, page_size, db)
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢

### ç®¡ç†å‘˜ä»ªè¡¨ç›˜
```typescript
// src/pages/Admin/Dashboard.tsx

const AdminDashboard: React.FC = () => {
  const { systemStatus, loading } = useSystemStatus();
  const { statistics } = useStatistics();
  
  return (
    <div className="admin-dashboard">
      <Row gutter={16}>
        <Col span={6}>
          <Statistic title="æ€»ç”¨æˆ·æ•°" value={statistics.total_users} />
        </Col>
        <Col span={6}>
          <Statistic title="æ´»è·ƒç”¨æˆ·" value={statistics.active_users} />
        </Col>
        <Col span={6}>
          <Statistic title="CPU ä½¿ç”¨ç‡" value={systemStatus.cpu_usage} suffix="%" />
        </Col>
        <Col span={6}>
          <Statistic title="å†…å­˜ä½¿ç”¨ç‡" value={systemStatus.memory_usage} suffix="%" />
        </Col>
      </Row>
      
      <Card title="ç”¨æˆ·å¢é•¿è¶‹åŠ¿">
        <Chart data={statistics.trend} type="line" />
      </Card>
      
      <Card title="æœ€è¿‘é”™è¯¯æ—¥å¿—">
        <ErrorLogTable />
      </Card>
    </div>
  );
};
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-16  
**å¼€å‘çŠ¶æ€**: å¾…å¼€å‘


# ç”Ÿäº§ç®¡ç†æ¨¡å— - å¼€å‘æŒ‡å—

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### åŠŸèƒ½å®šä½
ç”Ÿäº§ç®¡ç†æ¨¡å—ç”¨äºç®¡ç†ç„Šæ¥ç”Ÿäº§ä»»åŠ¡çš„è®¡åˆ’ã€æ‰§è¡Œã€è¿›åº¦è·Ÿè¸ªå’Œèµ„æºåˆ†é…ï¼Œç¡®ä¿ç”Ÿäº§ä»»åŠ¡æŒ‰æ—¶å®Œæˆã€‚

### é€‚ç”¨åœºæ™¯
- ç”Ÿäº§ä»»åŠ¡åˆ›å»ºå’Œåˆ†é…
- ç”Ÿäº§è¿›åº¦è·Ÿè¸ª
- èµ„æºè°ƒåº¦ç®¡ç†
- ç”Ÿäº§æ•°æ®è®°å½•
- ç”Ÿäº§ç»Ÿè®¡åˆ†æ

### å¼€å‘ä¼˜å…ˆçº§
**ç¬¬äºŒé˜¶æ®µ** - é‡è¦åŠŸèƒ½ï¼Œä¼˜å…ˆå¼€å‘

---

## ğŸ¯ ä¼šå‘˜æƒé™

### è®¿é—®æƒé™
| ä¼šå‘˜ç­‰çº§ | è®¿é—®æƒé™ | æ•°é‡é™åˆ¶ | åŠŸèƒ½èŒƒå›´ |
|---------|---------|---------|---------|
| æ¸¸å®¢æ¨¡å¼ | âŒ ä¸å¯è®¿é—® | 0 | - |
| ä¸ªäººå…è´¹ç‰ˆ | âŒ ä¸å¯è®¿é—® | 0 | - |
| ä¸ªäººä¸“ä¸šç‰ˆ | âŒ ä¸å¯è®¿é—® | 0 | - |
| ä¸ªäººé«˜çº§ç‰ˆ | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ |
| ä¸ªäººæ——èˆ°ç‰ˆ | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + é«˜çº§ç‰¹æ€§ |
| ä¼ä¸šç‰ˆ | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + ä¼ä¸šåä½œ |
| ä¼ä¸šPRO | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + ä¼ä¸šåä½œ |
| ä¼ä¸šPRO MAX | âœ… å¯è®¿é—® | æ— é™åˆ¶ | å®Œæ•´åŠŸèƒ½ + ä¼ä¸šåä½œ |

**é‡è¦è¯´æ˜**: ç”Ÿäº§ç®¡ç†åŠŸèƒ½ä»…å¯¹**ä¸ªäººé«˜çº§ç‰ˆåŠä»¥ä¸Š**ä¼šå‘˜å¼€æ”¾ã€‚

---

## ğŸ“Š åŠŸèƒ½æ¸…å•

### 1. ç”Ÿäº§ä»»åŠ¡ç®¡ç†
- **åˆ›å»ºä»»åŠ¡**: åˆ›å»ºç”Ÿäº§ä»»åŠ¡
- **ç¼–è¾‘ä»»åŠ¡**: ä¿®æ”¹ä»»åŠ¡ä¿¡æ¯
- **åˆ é™¤ä»»åŠ¡**: è½¯åˆ é™¤ä»»åŠ¡
- **ä»»åŠ¡è¯¦æƒ…**: æŸ¥çœ‹ä»»åŠ¡è¯¦ç»†ä¿¡æ¯
- **ä»»åŠ¡åˆ†é…**: åˆ†é…ä»»åŠ¡ç»™ç„Šå·¥
- **ä»»åŠ¡çŠ¶æ€**: ç®¡ç†ä»»åŠ¡çŠ¶æ€æµè½¬

### 2. è¿›åº¦è·Ÿè¸ª
- **è¿›åº¦æ›´æ–°**: æ›´æ–°ä»»åŠ¡è¿›åº¦
- **è¿›åº¦æŸ¥çœ‹**: æŸ¥çœ‹ä»»åŠ¡è¿›åº¦
- **é‡Œç¨‹ç¢‘ç®¡ç†**: è®¾ç½®å’Œè·Ÿè¸ªé‡Œç¨‹ç¢‘
- **å»¶æœŸé¢„è­¦**: ä»»åŠ¡å»¶æœŸé¢„è­¦
- **å®Œæˆç‡ç»Ÿè®¡**: ç»Ÿè®¡ä»»åŠ¡å®Œæˆç‡

### 3. èµ„æºç®¡ç†
- **ç„Šå·¥åˆ†é…**: åˆ†é…ç„Šå·¥åˆ°ä»»åŠ¡
- **è®¾å¤‡åˆ†é…**: åˆ†é…è®¾å¤‡åˆ°ä»»åŠ¡
- **ç„Šæåˆ†é…**: åˆ†é…ç„Šæåˆ°ä»»åŠ¡
- **WPS å…³è”**: å…³è”ä½¿ç”¨çš„ WPS
- **èµ„æºå†²çªæ£€æµ‹**: æ£€æµ‹èµ„æºå†²çª

### 4. ç”Ÿäº§æ•°æ®è®°å½•
- **å·¥æ—¶è®°å½•**: è®°å½•å®é™…å·¥æ—¶
- **ç„Šææ¶ˆè€—**: è®°å½•ç„Šææ¶ˆè€—é‡
- **è®¾å¤‡ä½¿ç”¨**: è®°å½•è®¾å¤‡ä½¿ç”¨æƒ…å†µ
- **è´¨é‡è®°å½•**: è®°å½•è´¨é‡æ£€éªŒç»“æœ
- **é—®é¢˜è®°å½•**: è®°å½•ç”Ÿäº§é—®é¢˜

### 5. ç»Ÿè®¡åˆ†æ
- **ä»»åŠ¡ç»Ÿè®¡**: æŒ‰çŠ¶æ€ã€æ—¶é—´ç»Ÿè®¡
- **æ•ˆç‡åˆ†æ**: åˆ†æç”Ÿäº§æ•ˆç‡
- **æˆæœ¬æ ¸ç®—**: è®¡ç®—ç”Ÿäº§æˆæœ¬
- **èµ„æºåˆ©ç”¨ç‡**: åˆ†æèµ„æºåˆ©ç”¨ç‡

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### ç”Ÿäº§ä»»åŠ¡è¡¨
```sql
CREATE TABLE production_tasks (
    -- ä¸»é”®å’ŒåŸºç¡€å­—æ®µ
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    company_id UUID REFERENCES companies(id) ON DELETE CASCADE,
    factory_id UUID REFERENCES factories(id) ON DELETE SET NULL,
    
    -- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯
    task_number VARCHAR(100) NOT NULL,             -- ä»»åŠ¡ç¼–å·
    task_name VARCHAR(255) NOT NULL,               -- ä»»åŠ¡åç§°
    task_type VARCHAR(50),                         -- ä»»åŠ¡ç±»å‹
    priority VARCHAR(20) DEFAULT 'normal',         -- ä¼˜å…ˆçº§: low, normal, high, urgent
    status VARCHAR(50) DEFAULT 'pending',          -- çŠ¶æ€: pending, in_progress, completed, cancelled
    
    -- æ—¶é—´ä¿¡æ¯
    planned_start_date DATE,                       -- è®¡åˆ’å¼€å§‹æ—¥æœŸ
    planned_end_date DATE,                         -- è®¡åˆ’ç»“æŸæ—¥æœŸ
    actual_start_date DATE,                        -- å®é™…å¼€å§‹æ—¥æœŸ
    actual_end_date DATE,                          -- å®é™…ç»“æŸæ—¥æœŸ
    
    -- å·¥ä½œé‡
    planned_hours DECIMAL(10,2),                  -- è®¡åˆ’å·¥æ—¶
    actual_hours DECIMAL(10,2) DEFAULT 0,         -- å®é™…å·¥æ—¶
    progress_percentage DECIMAL(5,2) DEFAULT 0,   -- å®Œæˆç™¾åˆ†æ¯”
    
    -- å…³è”ä¿¡æ¯
    wps_id UUID REFERENCES wps_records(id),        -- ä½¿ç”¨çš„ WPS
    pqr_id UUID REFERENCES pqr_records(id),        -- å…³è”çš„ PQR
    
    -- èµ„æºåˆ†é…
    assigned_welders JSONB,                        -- åˆ†é…çš„ç„Šå·¥åˆ—è¡¨
    assigned_equipment JSONB,                      -- åˆ†é…çš„è®¾å¤‡åˆ—è¡¨
    assigned_materials JSONB,                      -- åˆ†é…çš„ç„Šæåˆ—è¡¨
    
    -- æŠ€æœ¯è¦æ±‚
    technical_requirements TEXT,                   -- æŠ€æœ¯è¦æ±‚
    quality_requirements TEXT,                     -- è´¨é‡è¦æ±‚
    safety_requirements TEXT,                      -- å®‰å…¨è¦æ±‚
    
    -- æˆæœ¬ä¿¡æ¯
    estimated_cost DECIMAL(15,2),                 -- é¢„ä¼°æˆæœ¬
    actual_cost DECIMAL(15,2) DEFAULT 0,          -- å®é™…æˆæœ¬
    
    -- è´£ä»»äºº
    project_manager_id UUID REFERENCES users(id),  -- é¡¹ç›®ç»ç†
    supervisor_id UUID REFERENCES users(id),       -- ç›‘ç£äºº
    
    -- é™„ä»¶
    drawings JSONB,                                -- å›¾çº¸
    documents JSONB,                               -- æ–‡æ¡£
    photos JSONB,                                  -- ç…§ç‰‡
    
    -- å¤‡æ³¨
    notes TEXT,
    tags JSONB,
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    updated_by UUID REFERENCES users(id),
    deleted_at TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_user (user_id),
    INDEX idx_company (company_id),
    INDEX idx_factory (factory_id),
    INDEX idx_task_number (task_number),
    INDEX idx_status (status),
    INDEX idx_priority (priority),
    INDEX idx_planned_dates (planned_start_date, planned_end_date),
    INDEX idx_wps (wps_id),
    INDEX idx_deleted (deleted_at),
    
    UNIQUE (user_id, task_number)
);
```

### ç”Ÿäº§è®°å½•è¡¨
```sql
CREATE TABLE production_records (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL REFERENCES production_tasks(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- è®°å½•ä¿¡æ¯
    record_date DATE NOT NULL,                     -- è®°å½•æ—¥æœŸ
    shift VARCHAR(20),                             -- ç­æ¬¡
    
    -- å·¥ä½œä¿¡æ¯
    welder_id UUID REFERENCES welders(id),         -- ç„Šå·¥
    work_hours DECIMAL(8,2),                      -- å·¥ä½œæ—¶é•¿
    work_description TEXT,                         -- å·¥ä½œå†…å®¹
    
    -- ç„Šææ¶ˆè€—
    material_consumption JSONB,                    -- ç„Šææ¶ˆè€—è®°å½•
    
    -- è®¾å¤‡ä½¿ç”¨
    equipment_id UUID REFERENCES equipment(id),    -- ä½¿ç”¨çš„è®¾å¤‡
    equipment_hours DECIMAL(8,2),                 -- è®¾å¤‡ä½¿ç”¨æ—¶é•¿
    
    -- è´¨é‡ä¿¡æ¯
    quality_status VARCHAR(50),                    -- è´¨é‡çŠ¶æ€: pass, fail, rework
    defects_found TEXT,                            -- å‘ç°çš„ç¼ºé™·
    
    -- é—®é¢˜è®°å½•
    issues_encountered TEXT,                       -- é‡åˆ°çš„é—®é¢˜
    solutions_applied TEXT,                        -- è§£å†³æ–¹æ¡ˆ
    
    -- å¤‡æ³¨
    notes TEXT,
    
    -- å®¡è®¡å­—æ®µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    
    -- ç´¢å¼•
    INDEX idx_task (task_id),
    INDEX idx_user (user_id),
    INDEX idx_record_date (record_date),
    INDEX idx_welder (welder_id),
    INDEX idx_equipment (equipment_id)
);
```

---

## ğŸ”Œ APIæ¥å£

### 1. ä»»åŠ¡åˆ—è¡¨
```http
GET /api/v1/production/tasks?page=1&page_size=20&status=in_progress
Authorization: Bearer <token>
```

### 2. åˆ›å»ºä»»åŠ¡
```http
POST /api/v1/production/tasks
Authorization: Bearer <token>
Content-Type: application/json

{
  "task_number": "PT-2025-001",
  "task_name": "ç®¡é“ç„Šæ¥ä»»åŠ¡",
  "priority": "high",
  "planned_start_date": "2025-10-20",
  "planned_end_date": "2025-10-30",
  "planned_hours": 80,
  "wps_id": "uuid",
  "assigned_welders": ["uuid1", "uuid2"]
}
```

### 3. æ›´æ–°è¿›åº¦
```http
PUT /api/v1/production/tasks/{id}/progress
Authorization: Bearer <token>
Content-Type: application/json

{
  "progress_percentage": 50,
  "actual_hours": 40,
  "notes": "è¿›åº¦æ­£å¸¸"
}
```

### 4. æ·»åŠ ç”Ÿäº§è®°å½•
```http
POST /api/v1/production/tasks/{id}/records
Authorization: Bearer <token>
Content-Type: application/json

{
  "record_date": "2025-10-16",
  "welder_id": "uuid",
  "work_hours": 8,
  "work_description": "å®Œæˆç¬¬ä¸€æ®µç„Šæ¥",
  "quality_status": "pass"
}
```

### 5. ä»»åŠ¡ç»Ÿè®¡
```http
GET /api/v1/production/statistics
Authorization: Bearer <token>
```

---

## ğŸ’¼ ä¸šåŠ¡é€»è¾‘

### 1. ä»»åŠ¡è¿›åº¦æ›´æ–°
```python
class ProductionService:
    def update_task_progress(
        self,
        task_id: UUID,
        progress_data: TaskProgress,
        user_id: UUID,
        db: Session
    ) -> ProductionTask:
        """æ›´æ–°ä»»åŠ¡è¿›åº¦"""
        
        task = db.query(ProductionTask).filter(
            ProductionTask.id == task_id,
            ProductionTask.user_id == user_id
        ).first()
        
        if not task:
            raise HTTPException(404, "ä»»åŠ¡ä¸å­˜åœ¨")
        
        # æ›´æ–°è¿›åº¦
        task.progress_percentage = progress_data.progress_percentage
        task.actual_hours = progress_data.actual_hours
        
        # å¦‚æœè¿›åº¦è¾¾åˆ°100%ï¼Œè‡ªåŠ¨å®Œæˆä»»åŠ¡
        if progress_data.progress_percentage >= 100:
            task.status = "completed"
            task.actual_end_date = date.today()
        
        task.updated_at = datetime.now()
        db.commit()
        
        return task
```

### 2. å»¶æœŸæ£€æŸ¥
```python
def get_overdue_tasks(
    self,
    user_id: UUID,
    db: Session
) -> List[ProductionTask]:
    """è·å–å»¶æœŸä»»åŠ¡"""
    
    tasks = db.query(ProductionTask).filter(
        ProductionTask.user_id == user_id,
        ProductionTask.status.in_(["pending", "in_progress"]),
        ProductionTask.planned_end_date < date.today(),
        ProductionTask.deleted_at.is_(None)
    ).all()
    
    return tasks
```

---

## ğŸ” æƒé™æ§åˆ¶

```python
@router.get("/production/tasks")
@require_feature("production_management")  # éœ€è¦é«˜çº§ç‰ˆåŠä»¥ä¸Š
async def get_task_list(
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
):
    """è·å–ç”Ÿäº§ä»»åŠ¡åˆ—è¡¨"""
    service = ProductionService(db)
    return service.get_task_list(current_user.id, db)
```

---

## ğŸ¨ å‰ç«¯ç•Œé¢

### ä»»åŠ¡çœ‹æ¿
```typescript
// src/pages/Production/TaskBoard.tsx

const TaskBoard: React.FC = () => {
  const { tasks, loading } = useProductionTasks();
  
  const columns = {
    pending: tasks.filter(t => t.status === 'pending'),
    in_progress: tasks.filter(t => t.status === 'in_progress'),
    completed: tasks.filter(t => t.status === 'completed')
  };
  
  return (
    <div className="task-board">
      <Column title="å¾…å¼€å§‹" tasks={columns.pending} />
      <Column title="è¿›è¡Œä¸­" tasks={columns.in_progress} />
      <Column title="å·²å®Œæˆ" tasks={columns.completed} />
    </div>
  );
};
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-16  
**å¼€å‘çŠ¶æ€**: å·²å®ç°ï¼ˆéœ€æµ‹è¯•ï¼‰


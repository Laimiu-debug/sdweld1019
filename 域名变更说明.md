# 🔄 域名变更说明

## 变更内容

管理员门户的域名已从 `admin.sdhaohan.cn` 更改为 `laimiu.sdhaohan.cn`

---

## 📋 新的域名配置

| 服务 | 域名 | 用途 |
|------|------|------|
| 用户门户 | `sdhaohan.cn` | 普通用户访问的前端界面 |
| 管理门户 | `laimiu.sdhaohan.cn` | 管理员后台管理界面 ✨ **已更改** |
| 后端 API | `api.sdhaohan.cn` | 后端接口服务 |

---

## ✅ 已更新的文件

以下文件已全部更新为新域名：

### 配置文件 (3个)
1. ✅ `nginx/conf.d/default.conf` - Nginx 站点配置
2. ✅ `backend/.env.production` - 后端 CORS 配置
3. ✅ `deploy.sh` - 部署脚本

### 文档文件 (7个)
4. ✅ `DEPLOYMENT_GUIDE.md` - 部署指南
5. ✅ `QUICK_DEPLOY.md` - 快速部署参考
6. ✅ `DEPLOYMENT_CHECKLIST.md` - 部署检查清单
7. ✅ `DEPLOYMENT_FILES_SUMMARY.md` - 部署文件说明
8. ✅ `README.md` - 项目主文档
9. ✅ `部署准备完成.md` - 部署准备文档
10. ✅ `域名变更说明.md` - 本文档

---

## 🎯 部署前需要做的事

### 1. DNS 解析配置

在腾讯云 DNS 控制台，需要添加以下记录：

| 主机记录 | 记录类型 | 记录值 | 说明 |
|---------|---------|--------|------|
| @ | A | 43.142.188.252 | 主域名 |
| **laimiu** | **A** | **43.142.188.252** | **管理门户（新）** ✨ |
| api | A | 43.142.188.252 | API 域名 |

⚠️ **重要**: 不要再添加 `admin` 的 A 记录，改为添加 `laimiu`

### 2. 验证 DNS 解析

```bash
# 验证主域名
ping sdhaohan.cn

# 验证管理门户（新域名）
ping laimiu.sdhaohan.cn

# 验证 API 域名
ping api.sdhaohan.cn
```

所有域名都应该解析到 `43.142.188.252`

---

## 🔐 SSL 证书申请

部署脚本会自动为新域名申请 SSL 证书：

```bash
# 自动申请 laimiu.sdhaohan.cn 的证书
docker-compose run --rm certbot certonly --webroot \
    --webroot-path=/var/www/certbot \
    --email 2564786659@qq.com \
    --agree-tos \
    --no-eff-email \
    -d laimiu.sdhaohan.cn
```

证书将保存在：
```
nginx/certbot/conf/live/laimiu.sdhaohan.cn/
├── fullchain.pem
└── privkey.pem
```

---

## 🚀 部署步骤

### 步骤 1: 配置 DNS
在腾讯云 DNS 控制台添加 `laimiu` 的 A 记录

### 步骤 2: 验证 DNS
```bash
ping laimiu.sdhaohan.cn
```

### 步骤 3: 上传代码到服务器
```bash
# 方式 A: Git（推荐）
git add .
git commit -m "Update admin portal domain to laimiu.sdhaohan.cn"
git push

# 在服务器上
ssh root@43.142.188.252
cd <项目目录>
git pull

# 方式 B: SCP 上传
scp -r ./ root@43.142.188.252:/root/welding-system/
```

### 步骤 4: 运行部署脚本
```bash
ssh root@43.142.188.252
cd <项目目录>
chmod +x deploy.sh
./deploy.sh
```

部署脚本会自动：
- ✅ 构建所有 Docker 镜像
- ✅ 启动所有服务
- ✅ 为 `laimiu.sdhaohan.cn` 申请 SSL 证书
- ✅ 配置 Nginx 反向代理
- ✅ 初始化数据库

---

## 🔍 部署后验证

### 1. 检查服务状态
```bash
docker-compose ps
```

所有服务应该都是 `Up` 状态

### 2. 访问管理门户
```bash
# 测试 HTTPS
curl -I https://laimiu.sdhaohan.cn
```

应该返回 `200 OK`

### 3. 浏览器访问
打开浏览器访问：
```
https://laimiu.sdhaohan.cn
```

- [ ] 页面正常加载
- [ ] HTTPS 证书有效（绿色锁图标）
- [ ] 可以正常登录管理后台

### 4. 检查 CORS 配置
在管理门户的浏览器控制台，不应该看到任何 CORS 错误

---

## 📝 配置变更详情

### Nginx 配置变更
<augment_code_snippet path="nginx/conf.d/default.conf" mode="EXCERPT">
````nginx
# HTTPS - 管理门户 (laimiu.sdhaohan.cn)
server {
    listen 443 ssl http2;
    server_name laimiu.sdhaohan.cn;

    ssl_certificate /etc/letsencrypt/live/laimiu.sdhaohan.cn/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/laimiu.sdhaohan.cn/privkey.pem;
    ...
}
````
</augment_code_snippet>

### 后端 CORS 配置变更
<augment_code_snippet path="backend/.env.production" mode="EXCERPT">
````bash
ALLOWED_ORIGINS=["https://sdhaohan.cn", "https://laimiu.sdhaohan.cn", "https://api.sdhaohan.cn"]
````
</augment_code_snippet>

---

## ⚠️ 注意事项

1. **DNS 解析时间**: DNS 解析可能需要 5-10 分钟生效，请耐心等待

2. **SSL 证书申请**: 确保 DNS 已解析成功后再申请证书，否则会失败

3. **旧域名**: 如果之前已经部署过 `admin.sdhaohan.cn`，它将不再工作

4. **浏览器缓存**: 如果之前访问过旧域名，可能需要清除浏览器缓存

5. **书签更新**: 如果有保存管理门户的书签，需要更新为新域名

---

## 🆘 常见问题

### Q1: DNS 解析不生效怎么办？
**A**: 等待 5-10 分钟，然后使用以下命令检查：
```bash
nslookup laimiu.sdhaohan.cn
```

### Q2: SSL 证书申请失败？
**A**: 确保：
- DNS 已正确解析到服务器 IP
- 服务器安全组已开放 80 端口
- Nginx 服务正在运行

### Q3: 访问管理门户出现 CORS 错误？
**A**: 检查 `backend/.env.production` 中的 `ALLOWED_ORIGINS` 是否包含新域名

### Q4: 页面显示 502 Bad Gateway？
**A**: 检查后端服务是否正常运行：
```bash
docker-compose logs backend
```

---

## 📞 技术支持

如果遇到问题，请查看：
1. `DEPLOYMENT_GUIDE.md` - 详细部署指南
2. `QUICK_DEPLOY.md` - 快速参考
3. `DEPLOYMENT_CHECKLIST.md` - 检查清单

或查看服务日志：
```bash
docker-compose logs -f
```

---

**变更日期**: 2025-10-31  
**变更原因**: 用户要求  
**影响范围**: 管理门户域名  
**向后兼容**: 否（旧域名 admin.sdhaohan.cn 将不再工作）


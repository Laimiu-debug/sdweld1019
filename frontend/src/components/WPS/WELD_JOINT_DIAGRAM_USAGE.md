# 焊接接头示意图生成功能使用指南

## 功能概述

焊接接头示意图生成功能允许用户通过两种方式为 WPS（焊接工艺规范）模板添加焊接接头示意图：

1. **上传图片** - 上传现有的焊接接头示意图
2. **自动生成** - 根据参数自动生成焊接接头示意图

## 组件结构

### 1. WeldJointDiagramGenerator.tsx
**焊接接头示意图生成器组件**

负责根据用户输入的参数自动生成焊接接头示意图。

**支持的参数：**

#### 接头类型 (Joint Type)
- `butt` - 对接接头
- `lap` - 搭接接头
- `t_joint` - T形接头
- `corner` - 角接头
- `edge` - 边接头

#### 坡口类型 (Groove Type)
- `V` - V型坡口
- `U` - U型坡口
- `J` - J型坡口
- `X` - X型坡口
- `none` - 无坡口

#### 尺寸参数
- `thickness` - 板厚 (mm)
- `grooveAngle` - 坡口角度 (°)
- `rootGap` - 根部间隙 (mm)
- `grooveDepth` - 坡口深度 (mm)
- `weldWidth` - 焊缝宽度 (mm)

#### 焊接工艺参数
- `layerCount` - 焊层数
- `passPerLayer` - 每层焊道数
- `weldingDirection` - 焊接方向

### 2. WeldJointDiagramField.tsx
**焊接接头图表字段组件**

集成了上传和自动生成功能的字段组件，提供用户友好的界面。

**功能：**
- 显示已上传或生成的图片
- 支持图片预览
- 支持删除图片
- 打开生成器模态框

### 3. ModuleFormRenderer.tsx
**模块表单渲染器**

已更新以支持新的焊接接头图表字段类型。

**识别逻辑：**
- 字段 key 为 `joint_diagram` 或标签包含 "接头示意图" 时，使用 WeldJointDiagramField

## 使用流程

### 在 WPS 模板中使用

1. **创建或编辑 WPS 模板**
   - 进入 WPS 管理页面
   - 创建新模板或编辑现有模板

2. **添加示意图模块**
   - 从模块库中拖拽 "示意图" 模块到模板
   - 或在编辑时选择 "示意图" 模块

3. **填充接头示意图**
   - 选择上传图片或自动生成
   - 如果选择自动生成：
     - 选择接头类型（对接、搭接等）
     - 选择坡口类型（V型、U型等）
     - 输入尺寸参数
     - 输入焊接工艺参数
     - 点击 "生成图表" 预览
     - 点击 "生成图表" 按钮确认

4. **填充其他字段**
   - 焊接顺序 - 描述焊接顺序
   - 尺寸标注 - 添加尺寸标注说明

5. **保存模板**
   - 点击保存按钮保存 WPS 模板

## 参数建议

### 对接接头 (Butt Joint)
- 板厚: 5-20mm
- 坡口角度: 60-90°
- 根部间隙: 1-3mm
- 坡口深度: 板厚的 80-100%

### 搭接接头 (Lap Joint)
- 板厚: 3-10mm
- 搭接长度: 板厚的 5-10倍

### T形接头 (T-Joint)
- 板厚: 5-15mm
- 坡口角度: 45-60°
- 根部间隙: 1-2mm

### 角接头 (Corner Joint)
- 板厚: 3-12mm
- 坡口角度: 45-90°

## 技术实现细节

### Canvas 绘制
- 使用 HTML5 Canvas 2D API 进行绘制
- 支持实时预览
- 可导出为 PNG 图片

### 图片处理
- 生成的图片转换为 Blob
- 创建 File 对象
- 转换为 UploadFile 对象供表单使用

### 集成方式
- 通过 ModuleFormRenderer 自动识别字段类型
- 无需修改现有的表单提交逻辑
- 生成的图片与上传的图片处理方式相同

## 扩展建议

### 未来可能的增强功能
1. 支持更多接头类型（如环形接头、斜接等）
2. 支持多层焊接的可视化
3. 支持焊接方向的可视化
4. 支持焊接缺陷标注
5. 支持尺寸标注的自动生成
6. 支持 SVG 导出
7. 支持 PDF 导出

## 故障排除

### 图表不显示
- 检查浏览器是否支持 Canvas
- 检查参数是否有效
- 查看浏览器控制台是否有错误

### 生成失败
- 确保所有必需参数都已填写
- 检查参数值是否在有效范围内
- 尝试刷新页面重新尝试

### 图片无法保存
- 检查表单提交是否成功
- 查看网络请求是否有错误
- 检查后端是否正确处理了图片数据


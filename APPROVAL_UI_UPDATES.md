# PQR/pPQR 审批UI更新说明

## 更新内容

为PQR和pPQR列表页面添加了与WPS相同的审批状态显示样式。

## 新增功能

### 1. 卡片头部审批状态标签

在每个PQR/pPQR卡片的右上角显示审批状态标签：

- **已批准** - 绿色标签，带✓图标
- **已拒绝** - 红色标签，带✗图标
- **待审批** - 蓝色标签，带⏰图标
- **审批中** - 蓝色标签，带⏰图标

同时显示工作流名称（如果有）。

### 2. 审批状态提示框

在卡片内容区域显示醒目的审批状态提示框（Alert组件）：

#### 已批准状态
- **类型**: 成功提示（绿色背景）
- **图标**: ✓ CheckCircleOutlined
- **消息**: "已批准"
- **描述**: 
  - PQR: "此PQR已通过审批，评定结果有效"
  - pPQR: "此pPQR已通过审批，试验结果有效"

#### 已拒绝状态
- **类型**: 错误提示（红色背景）
- **图标**: ✗ CloseCircleOutlined
- **消息**: "已拒绝"
- **描述**: "此PQR/pPQR审批被拒绝，需要修改后重新提交"

#### 审批中状态
- **类型**: 警告提示（黄色背景）
- **图标**: ⏰ ClockCircleOutlined
- **消息**: "审批中"
- **描述**: "此PQR/pPQR正在审批流程中，请等待审批完成"

#### 草稿状态
- **类型**: 信息提示（蓝色背景）
- **图标**: ⏰ ClockCircleOutlined
- **消息**: "草稿状态"
- **描述**: "此PQR/pPQR处于草稿状态，可以提交审批"

### 3. 审批按钮

在操作按钮区域添加了审批按钮，支持：
- 提交审批
- 查看审批进度
- 取消审批（仅提交人）
- 审批操作（仅审批人）

## 修改的文件

### PQR模块
1. `frontend/src/pages/PQR/PQRList.tsx`
   - 添加审批状态图标导入
   - 添加卡片头部审批状态标签
   - 添加审批状态提示框
   - 集成ApprovalButton组件

2. `frontend/src/pages/PQR/PQRDetail.tsx`
   - 添加ApprovalButton和ApprovalHistory组件
   - 显示审批历史记录

### pPQR模块
1. `frontend/src/pages/pPQR/PPQRList.tsx`
   - 添加审批状态图标导入
   - 添加卡片头部审批状态标签
   - 添加审批状态提示框
   - 集成ApprovalButton组件

2. `frontend/src/pages/pPQR/PPQRDetail.tsx`
   - 添加ApprovalButton和ApprovalHistory组件
   - 显示审批历史记录

## 视觉效果

### 卡片布局
```
┌─────────────────────────────────────────────────────┐
│ PQR-123456                    [草稿] [待审批]       │
│ 标题文本                      工作流: 标准审批流程  │
├─────────────────────────────────────────────────────┤
│ 版本: A                       试验日期: 2025-10-27  │
│ 母材规格: Q345                评定结果: 合格         │
│ 焊接工艺: GMAW                关联WPS: WPS-001      │
│ 创建时间: 2025-10-27                                │
├─────────────────────────────────────────────────────┤
│ ⓘ 草稿状态                                          │
│    此PQR处于草稿状态，可以提交审批                  │
├─────────────────────────────────────────────────────┤
│ [查看] [编辑] [复制] [PDF] [Excel] [提交审批]      │
│                                            [删除]    │
└─────────────────────────────────────────────────────┘
```

### 审批状态颜色方案

| 状态 | 标签颜色 | 提示框类型 | 背景色 |
|------|---------|-----------|--------|
| 已批准 | success (绿色) | success | 浅绿色 |
| 已拒绝 | error (红色) | error | 浅红色 |
| 审批中 | processing (蓝色) | warning | 浅黄色 |
| 待审批 | processing (蓝色) | warning | 浅黄色 |
| 草稿 | default (灰色) | info | 浅蓝色 |

## 用户体验改进

1. **一目了然的状态显示**
   - 用户可以快速识别文档的审批状态
   - 颜色编码帮助快速区分不同状态

2. **清晰的操作指引**
   - 提示框提供明确的下一步操作建议
   - 审批按钮根据权限和状态动态显示

3. **完整的审批信息**
   - 显示工作流名称
   - 显示审批历史记录
   - 显示当前审批步骤

## 与WPS的一致性

现在PQR和pPQR列表的审批状态显示与WPS完全一致：

✓ 相同的标签样式和颜色
✓ 相同的提示框设计
✓ 相同的图标使用
✓ 相同的布局结构
✓ 相同的用户交互方式

## 测试建议

1. **视觉测试**
   - 检查不同审批状态下的卡片显示
   - 验证颜色和图标是否正确
   - 确认布局在不同屏幕尺寸下的表现

2. **功能测试**
   - 测试提交审批功能
   - 测试审批操作（批准/拒绝/退回）
   - 测试取消审批功能
   - 验证审批历史记录显示

3. **权限测试**
   - 验证不同角色用户看到的按钮是否正确
   - 测试审批权限控制
   - 测试工作区切换时的行为

## 注意事项

1. 确保后端API返回正确的审批状态字段
2. 确保已配置审批工作流
3. 确保在企业工作区中测试（个人工作区不支持审批）
4. 审批按钮的显示逻辑依赖于后端返回的权限字段


# 📤 上传代码到服务器指南

## 🎯 目标

将本地代码上传到腾讯云服务器: `43.142.188.252`

项目将上传到: `/root/welding-system`

---

## 🚀 方式一：使用自动化脚本（推荐）

我已经为你创建了自动化上传脚本，选择其中一个运行即可。

### 选项 A: PowerShell 脚本（推荐）

在项目根目录，右键点击 `upload_to_server.ps1`，选择"使用 PowerShell 运行"

或者在 PowerShell 中执行：
```powershell
.\upload_to_server.ps1
```

**如果提示执行策略错误**，先运行：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 选项 B: 批处理脚本

双击运行 `upload_to_server.bat`

或者在命令提示符中执行：
```cmd
upload_to_server.bat
```

---

## 📋 脚本会自动完成以下操作

1. ✅ 连接到服务器 `43.142.188.252`
2. ✅ 在服务器上创建项目目录 `/root/welding-system`
3. ✅ 上传所有项目文件（自动排除 node_modules 等）
4. ✅ 设置脚本执行权限
5. ✅ 询问是否立即开始部署

---

## 🔐 SSH 连接说明

### 首次连接

第一次连接服务器时，会提示：
```
The authenticity of host '43.142.188.252' can't be established.
Are you sure you want to continue connecting (yes/no)?
```

输入: `yes`

### 密码输入

脚本会提示输入服务器密码，输入你的腾讯云服务器 root 密码即可。

**注意**: 输入密码时不会显示任何字符，这是正常的，输入完成后按回车。

---

## ⏱️ 上传时间

根据网络速度，上传时间约为：
- **快速网络**: 2-3 分钟
- **普通网络**: 5-8 分钟
- **慢速网络**: 10-15 分钟

---

## 🛠️ 方式二：手动上传（备选）

如果自动化脚本无法使用，可以手动上传。

### 步骤 1: 创建服务器目录

```powershell
ssh root@43.142.188.252
mkdir -p /root/welding-system
exit
```

### 步骤 2: 上传代码

在项目根目录执行：

```powershell
scp -r . root@43.142.188.252:/root/welding-system/
```

### 步骤 3: 设置权限

```powershell
ssh root@43.142.188.252
cd /root/welding-system
chmod +x deploy.sh create_default_admin.sh
```

---

## 🖥️ 方式三：使用图形化工具

如果不习惯命令行，可以使用图形化 SFTP 工具。

### 推荐工具

#### 1. WinSCP（推荐）

**下载**: https://winscp.net/

**配置**:
- 文件协议: SFTP
- 主机名: `43.142.188.252`
- 端口: `22`
- 用户名: `root`
- 密码: (你的服务器密码)

**操作**:
1. 连接到服务器
2. 在右侧（服务器端）创建目录: `/root/welding-system`
3. 将左侧（本地）的所有文件拖拽到右侧
4. 等待上传完成

#### 2. FileZilla

**下载**: https://filezilla-project.org/

**配置**:
- 协议: SFTP
- 主机: `43.142.188.252`
- 端口: `22`
- 用户: `root`
- 密码: (你的服务器密码)

**操作**:
1. 快速连接
2. 在远程站点创建 `/root/welding-system`
3. 上传所有文件

#### 3. MobaXterm

**下载**: https://mobaxterm.mobatek.net/

**特点**: 集成了 SSH 和 SFTP，非常方便

---

## ✅ 验证上传成功

上传完成后，验证文件是否正确上传：

```bash
# SSH 登录服务器
ssh root@43.142.188.252

# 进入项目目录
cd /root/welding-system

# 查看文件列表
ls -la

# 应该看到以下文件和目录
# backend/
# frontend/
# admin-portal/
# nginx/
# docker-compose.yml
# deploy.sh
# create_default_admin.sh
# 等等...

# 检查关键文件
ls -l backend/.env.production
ls -l docker-compose.yml
ls -l deploy.sh
```

---

## 🚀 上传后的下一步

### 方式 A: 自动部署（如果脚本询问）

如果上传脚本询问"是否现在就开始部署？"，输入 `y` 即可自动开始部署。

### 方式 B: 手动部署

```bash
# 1. SSH 登录服务器
ssh root@43.142.188.252

# 2. 进入项目目录
cd /root/welding-system

# 3. 运行部署脚本
./deploy.sh
```

### 方式 C: 一键部署（在本地执行）

```powershell
ssh root@43.142.188.252 "cd /root/welding-system && ./deploy.sh"
```

---

## ❓ 常见问题

### Q1: 提示 "ssh: command not found"

**原因**: Windows 未安装 OpenSSH 客户端

**解决方法**:

**Windows 10/11**:
1. 打开"设置" → "应用" → "可选功能"
2. 点击"添加功能"
3. 搜索"OpenSSH 客户端"
4. 安装

或者使用图形化工具（WinSCP、FileZilla）

### Q2: 提示 "Permission denied"

**原因**: SSH 密钥或密码错误

**解决方法**:
1. 确认服务器密码正确
2. 或者配置 SSH 密钥登录

### Q3: 上传速度很慢

**原因**: 网络速度限制

**解决方法**:
1. 使用有线网络
2. 关闭其他占用带宽的程序
3. 考虑使用 rsync（增量上传）

### Q4: 提示 "Connection refused"

**原因**: 服务器 SSH 端口未开放

**解决方法**:
1. 登录腾讯云控制台
2. 检查安全组规则
3. 确保端口 22 已开放

### Q5: 上传后文件缺失

**原因**: 某些文件被排除或上传失败

**解决方法**:
1. 检查 `.gitignore` 文件
2. 手动上传缺失的文件
3. 使用 `scp -r` 重新上传

---

## 📝 上传清单

确保以下文件和目录都已上传：

### 必需的目录
- [ ] `backend/` - 后端代码
- [ ] `frontend/` - 前端代码
- [ ] `admin-portal/` - 管理门户代码
- [ ] `nginx/` - Nginx 配置

### 必需的配置文件
- [ ] `docker-compose.yml` - Docker 编排
- [ ] `backend/.env.production` - 后端环境变量（包含授权码）
- [ ] `frontend/.env.production` - 前端环境变量
- [ ] `admin-portal/.env.production` - 管理门户环境变量
- [ ] `backend/Dockerfile` - 后端 Docker 镜像
- [ ] `frontend/Dockerfile` - 前端 Docker 镜像
- [ ] `admin-portal/Dockerfile` - 管理门户 Docker 镜像

### 必需的脚本
- [ ] `deploy.sh` - 部署脚本
- [ ] `create_default_admin.sh` - 管理员创建脚本

### 可选的文档
- [ ] `README.md`
- [ ] `DEPLOYMENT_GUIDE.md`
- [ ] 其他文档文件

---

## 🔐 安全提醒

### 敏感文件检查

确保以下敏感文件已正确上传：

1. ✅ `backend/.env.production` - 包含 QQ 邮箱授权码
2. ✅ 检查授权码是否为: `rsheuhkrdlqpecij`

### 验证命令

```bash
# SSH 登录服务器
ssh root@43.142.188.252

# 检查授权码
cd /root/welding-system
grep SMTP_PASSWORD backend/.env.production

# 应该显示: SMTP_PASSWORD=rsheuhkrdlqpecij
```

---

## 📊 上传进度

使用脚本上传时，你会看到类似的输出：

```
========================================
上传代码到腾讯云服务器
========================================

服务器 IP: 43.142.188.252
项目目录: /root/welding-system

========================================
步骤 1: 在服务器上创建项目目录
========================================

正在连接服务器...
✓ 项目目录创建成功: /root/welding-system

========================================
步骤 2: 上传代码到服务器
========================================

正在上传文件，请稍候...
这可能需要几分钟时间，取决于网络速度

[上传进度显示...]

✓ 代码上传成功！

========================================
步骤 3: 设置脚本执行权限
========================================

正在设置执行权限...
✓ 执行权限设置成功

========================================
上传完成！
========================================

是否现在就开始部署？(y/n):
```

---

## 🎯 快速开始

**最简单的方式**:

1. 双击运行 `upload_to_server.bat`
2. 输入服务器密码
3. 等待上传完成
4. 当询问"是否现在就开始部署？"时，输入 `y`
5. 等待部署完成

**预计总时间**: 20-30 分钟（包括上传和部署）

---

## 📞 需要帮助？

如果上传过程中遇到问题：

1. 检查网络连接
2. 确认服务器 IP 和密码正确
3. 查看错误信息
4. 尝试使用图形化工具（WinSCP）

---

**服务器信息**:
- IP: `43.142.188.252`
- 用户: `root`
- 项目目录: `/root/welding-system`

**准备好了吗？运行上传脚本开始吧！** 🚀


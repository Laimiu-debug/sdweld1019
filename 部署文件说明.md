# 📦 部署文件说明

## 🎯 我为你创建的文件

为了帮助你使用Git方式将项目部署到云服务器的普通用户目录，我创建了以下文件：

---

## 📄 文件清单

### 1. 核心部署脚本

#### `首次部署到服务器.ps1` ⭐ 推荐
**用途**: 自动化首次部署脚本

**功能**:
- ✅ 检查并推送代码到Git仓库
- ✅ 在服务器上创建ubuntu用户
- ✅ 安装Docker和docker-compose
- ✅ 克隆代码到 `/home/ubuntu/sdweld`
- ✅ 上传环境配置文件
- ✅ 自动执行部署

**使用场景**: 第一次部署时使用

**使用方法**:
```powershell
.\首次部署到服务器.ps1
```

---

#### `更新服务器代码.ps1` ⭐ 推荐
**用途**: 自动化代码更新脚本

**功能**:
- ✅ 推送本地代码到Git
- ✅ 在服务器上拉取最新代码
- ✅ 提供3种部署选项：
  - 快速重启（仅重启服务）
  - 完整重新部署（重新构建镜像）
  - 跳过部署

**使用场景**: 后续更新代码时使用

**使用方法**:
```powershell
.\更新服务器代码.ps1
```

---

### 2. 详细文档

#### `Git部署到普通目录.md`
**用途**: 完整的手动部署指南

**内容**:
- 📋 详细的部署步骤
- 🔧 服务器配置说明
- 🛠️ 常用管理命令
- ❓ 常见问题解答
- 💡 最佳实践建议

**使用场景**: 想手动控制每一步，或自动化脚本遇到问题时参考

---

#### `README-部署说明.md`
**用途**: 快速参考文档

**内容**:
- 🚀 快速开始指南
- 📁 部署目录说明
- 🔧 必须配置项
- 🛠️ 常用命令
- ❓ 常见问题

**使用场景**: 快速查找部署相关信息

---

#### `快速开始.txt`
**用途**: 纯文本快速参考卡片

**内容**:
- 服务器信息
- 首次部署3步骤
- 更新代码方法
- 常用命令

**使用场景**: 快速查看关键信息

---

### 3. 其他辅助文件

#### `部署前检查清单.md`
**用途**: 部署前的检查清单

**内容**:
- ✅ QQ邮箱授权码配置
- ✅ 域名DNS解析配置
- ✅ 服务器安全组配置
- ✅ 本地环境检查

---

#### `一键部署到云服务器.md`
**用途**: 通用部署指南（包含多种部署方式）

**内容**:
- 方式一：自动化脚本部署
- 方式二：手动部署
- 配置说明
- 常见问题

---

### 4. 旧版脚本（可选）

#### `deploy-to-server.ps1`
**用途**: 完整的自动化部署脚本（使用SCP上传）

**说明**: 这是之前创建的脚本，使用SCP方式上传代码。如果你不想使用Git方式，可以使用这个脚本。

#### `快速部署.ps1`
**用途**: 简化版的SCP上传部署脚本

**说明**: 同样是使用SCP方式，比较简单直接。

---

## 🎯 推荐使用方式

### 首次部署

1. **配置QQ邮箱授权码**
   ```
   编辑: backend\.env.production
   修改: SMTP_PASSWORD=你的QQ邮箱授权码
   ```

2. **推送代码到Git**（如果还没有）
   ```powershell
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin <你的仓库地址>
   git push -u origin main
   ```

3. **运行首次部署脚本**
   ```powershell
   .\首次部署到服务器.ps1
   ```

### 后续更新

```powershell
.\更新服务器代码.ps1
```

---

## 📋 部署目录对比

### 之前的方案（root目录）
```
/root/sdweld/
```
- ❌ 使用root用户，权限过大
- ❌ 不符合最佳实践
- ❌ 安全风险较高

### 现在的方案（普通用户目录）⭐
```
/home/ubuntu/sdweld/
```
- ✅ 使用普通用户ubuntu
- ✅ 符合Linux最佳实践
- ✅ 更安全、更规范
- ✅ 权限隔离更清晰

---

## 🔑 关键配置

### SSH密钥
已内置在脚本中，会自动创建 `server-key.pem` 文件。

### 服务器信息
- **IP**: 43.142.188.252
- **用户**: ubuntu（通过root登录后切换）
- **目录**: /home/ubuntu/sdweld

### Git仓库
需要你自己创建并推送代码到：
- GitHub: https://github.com
- Gitee: https://gitee.com（国内速度更快）

---

## 🌐 部署后访问

- **用户门户**: https://sdhaohan.cn
- **管理门户**: https://laimiu.sdhaohan.cn
- **后端API**: https://api.sdhaohan.cn
- **API文档**: https://api.sdhaohan.cn/api/v1/docs

---

## 🛠️ 工作流程

```
开发阶段
   ↓
修改代码
   ↓
本地测试
   ↓
运行: .\首次部署到服务器.ps1 (首次)
   或
运行: .\更新服务器代码.ps1 (更新)
   ↓
自动推送到Git
   ↓
服务器拉取代码
   ↓
自动部署
   ↓
访问: https://sdhaohan.cn
```

---

## ❓ 选择哪个脚本？

### 使用Git方式（推荐）⭐

**优势**:
- ✅ 代码版本控制
- ✅ 更新速度快（增量更新）
- ✅ 可以回滚到任意版本
- ✅ 团队协作方便

**使用**:
- 首次: `.\首次部署到服务器.ps1`
- 更新: `.\更新服务器代码.ps1`

### 使用SCP方式

**优势**:
- ✅ 不需要Git仓库
- ✅ 适合快速测试

**使用**:
- `.\deploy-to-server.ps1` 或 `.\快速部署.ps1`

---

## 💡 最佳实践

1. **首次部署前**
   - ✅ 配置QQ邮箱授权码
   - ✅ 推送代码到Git
   - ✅ 检查域名DNS解析

2. **日常开发**
   - ✅ 本地测试通过后再部署
   - ✅ 使用 `更新服务器代码.ps1`
   - ✅ 定期查看服务器日志

3. **安全建议**
   - ✅ 不要将 `.env.production` 提交到Git
   - ✅ 定期备份数据库
   - ✅ 妥善保管SSH密钥

---

## 📞 需要帮助？

1. **快速参考**: `快速开始.txt`
2. **详细文档**: `README-部署说明.md`
3. **手动部署**: `Git部署到普通目录.md`
4. **检查清单**: `部署前检查清单.md`

---

## 🎉 总结

我为你创建了一套完整的Git部署方案，包括：

- ✅ 2个自动化脚本（首次部署 + 更新代码）
- ✅ 4个详细文档（部署指南 + 快速参考）
- ✅ 部署到普通用户目录（更安全、更规范）
- ✅ 完整的错误处理和提示

**现在你可以开始部署了！** 🚀

推荐使用：
```powershell
.\首次部署到服务器.ps1
```

祝部署顺利！🎊


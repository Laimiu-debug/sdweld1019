# 🚀 开始部署 - 最后一步！

## ✅ 准备工作已全部完成！

恭喜！所有配置已经完成，现在可以开始部署了！

---

## 📋 已完成的配置

- ✅ **QQ 邮箱授权码**: rsheuhkrdlqpecij
- ✅ **管理员账号**: Laimiu.new@gmail.com / ghzzz123
- ✅ **域名规划**: sdhaohan.cn, laimiu.sdhaohan.cn, api.sdhaohan.cn
- ✅ **数据库密码**: WeldDB@2024#Secure!Pass
- ✅ **Redis 密码**: Redis@2024#Strong!Key
- ✅ **环境变量**: backend/.env.production 已配置
- ✅ **Docker 配置**: docker-compose.yml 已就绪
- ✅ **Nginx 配置**: 反向代理和 SSL 已配置
- ✅ **部署脚本**: deploy.sh 已准备好

---

## 🎯 现在只需要 3 步！

### 📍 第 1 步：配置 DNS 解析

登录腾讯云 DNS 控制台：https://console.cloud.tencent.com/cns

添加以下 A 记录：

```
主机记录: @
记录类型: A
记录值: 43.142.188.252
TTL: 600

主机记录: laimiu
记录类型: A
记录值: 43.142.188.252
TTL: 600

主机记录: api
记录类型: A
记录值: 43.142.188.252
TTL: 600
```

**验证 DNS**：
```bash
ping sdhaohan.cn
ping laimiu.sdhaohan.cn
ping api.sdhaohan.cn
```

⏰ **等待 5-10 分钟让 DNS 生效**

---

### 📤 第 2 步：上传代码到服务器

#### 方式 A: 使用自动化脚本（推荐）⭐

**最简单的方式！**

双击运行 `upload_to_server.bat` 或右键运行 `upload_to_server.ps1`

脚本会自动：
- ✅ 连接到服务器 `43.142.188.252`
- ✅ 创建项目目录 `/root/welding-system`
- ✅ 上传所有文件（包括敏感配置）
- ✅ 设置脚本执行权限
- ✅ 询问是否立即开始部署

**详细说明**: 查看 `上传代码指南.md`

#### 方式 B: 使用图形化工具

使用 **WinSCP** 或 **FileZilla**:
- 主机: `43.142.188.252`
- 用户: `root`
- 端口: `22`
- 协议: SFTP
- 上传到: `/root/welding-system`

#### 方式 C: 手动 SCP 上传

```powershell
# 在项目根目录执行
scp -r . root@43.142.188.252:/root/welding-system/
```

---

### 🚀 第 3 步：运行部署脚本

```bash
# 1. SSH 登录服务器
ssh root@43.142.188.252

# 2. 进入项目目录
cd /root/welding-system  # 或你的项目目录

# 3. 给脚本添加执行权限
chmod +x deploy.sh
chmod +x create_default_admin.sh

# 4. 运行部署脚本
./deploy.sh
```

---

## 📝 部署过程中的交互

### 1. 环境检查
脚本会自动检查 Docker 和 Docker Compose 是否已安装。

### 2. QQ 邮箱授权码确认
```
⚠️  重要提示：请确认已配置 QQ 邮箱授权码
请检查 backend/.env.production 文件中的 SMTP_PASSWORD 是否已填写

是否已配置 QQ 邮箱授权码？(y/n):
```
输入: `y`

### 3. 创建管理员账号
```
是否创建管理员账号？(y/n):
```
输入: `y`

```
请输入管理员邮箱:
```
输入: `Laimiu.new@gmail.com`

```
请输入管理员密码:
```
输入: `ghzzz123`

### 4. SSL 证书申请
```
是否申请 SSL 证书？(y/n):
```
输入: `y`

脚本会自动为三个域名申请 Let's Encrypt 免费证书。

---

## ⏱️ 部署时间线

| 步骤 | 预计时间 | 说明 |
|------|---------|------|
| DNS 配置 | 2 分钟 | 在腾讯云控制台添加记录 |
| DNS 生效 | 5-10 分钟 | 等待 DNS 解析生效 |
| 上传代码 | 2-5 分钟 | 取决于网络速度 |
| Docker 构建 | 5-8 分钟 | 构建所有镜像 |
| 服务启动 | 1-2 分钟 | 启动所有容器 |
| 数据库迁移 | 30 秒 | 初始化数据库 |
| SSL 证书申请 | 1-2 分钟 | 为三个域名申请证书 |
| **总计** | **15-20 分钟** | 从开始到完成 |

---

## 🎉 部署成功标志

当你看到以下输出时，说明部署成功：

```
========================================
部署完成！
========================================

✓ 用户门户: https://sdhaohan.cn
✓ 管理门户: https://laimiu.sdhaohan.cn
✓ 后端API: https://api.sdhaohan.cn
✓ API文档: https://api.sdhaohan.cn/api/v1/docs

请访问以上地址验证部署是否成功
```

---

## ✅ 部署后验证

### 1. 检查服务状态
```bash
docker-compose ps
```

所有服务应该都是 `Up` 状态。

### 2. 访问用户门户
打开浏览器访问: **https://sdhaohan.cn**

- [ ] 页面正常加载
- [ ] HTTPS 证书有效（绿色锁）
- [ ] 可以注册账号
- [ ] 可以收到验证码邮件

### 3. 访问管理门户
打开浏览器访问: **https://laimiu.sdhaohan.cn**

- [ ] 页面正常加载
- [ ] HTTPS 证书有效
- [ ] 使用以下账号登录：
  - 邮箱: `Laimiu.new@gmail.com`
  - 密码: `ghzzz123`

### 4. 访问 API 文档
打开浏览器访问: **https://api.sdhaohan.cn/api/v1/docs**

- [ ] Swagger 文档正常显示
- [ ] 可以测试 API 接口

### 5. 测试健康检查
```bash
curl https://api.sdhaohan.cn/api/v1/health
```

应该返回：
```json
{
  "status": "healthy",
  "app_name": "Welding System Backend",
  "version": "1.0.0",
  "environment": "production"
}
```

---

## 🛠️ 如果遇到问题

### 问题 1: DNS 解析失败
```bash
# 检查 DNS
nslookup sdhaohan.cn

# 等待 5-10 分钟后重试
```

### 问题 2: SSL 证书申请失败
```bash
# 确认 DNS 已解析
ping sdhaohan.cn

# 确认端口 80 已开放
curl http://sdhaohan.cn/.well-known/acme-challenge/test

# 手动重新申请
docker-compose run --rm certbot certonly --webroot \
    --webroot-path=/var/www/certbot \
    --email 2564786659@qq.com \
    --agree-tos \
    -d sdhaohan.cn
```

### 问题 3: 服务无法启动
```bash
# 查看日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs backend
docker-compose logs nginx

# 重启服务
docker-compose restart
```

### 问题 4: 邮件发送失败
```bash
# 检查配置
cat backend/.env.production | grep SMTP

# 查看后端日志
docker-compose logs backend | grep -i smtp

# 重启后端
docker-compose restart backend
```

---

## 📚 相关文档

部署过程中如需帮助，请查看：

1. **快速部署指南.md** - 详细的部署步骤
2. **配置信息汇总.md** - 所有配置信息（敏感）
3. **DEPLOYMENT_GUIDE.md** - 完整部署指南
4. **DEPLOYMENT_CHECKLIST.md** - 部署检查清单
5. **QUICK_DEPLOY.md** - 快速参考

---

## 🎊 部署成功后

### 立即可以做的事：

1. ✅ 登录管理门户: https://laimiu.sdhaohan.cn
   - 邮箱: Laimiu.new@gmail.com
   - 密码: ghzzz123

2. ✅ 创建企业工作空间

3. ✅ 添加用户和角色

4. ✅ 创建 WPS/PQR 文档

5. ✅ 配置系统设置

### 建议的后续工作：

1. 📊 设置数据库自动备份
2. 📧 测试邮件发送功能
3. 🔐 修改默认管理员密码（可选）
4. 📱 配置短信服务（可选）
5. 💳 配置支付服务（可选）

---

## 🔐 安全提醒

1. ⚠️ **配置信息汇总.md** 包含所有敏感信息，请妥善保管
2. ⚠️ 不要将 **backend/.env.production** 提交到公开仓库
3. ⚠️ 定期备份数据库
4. ⚠️ 定期更新系统和 Docker 镜像
5. ⚠️ 监控服务器资源使用情况

---

## 📞 需要帮助？

如果遇到任何问题：

1. 查看日志: `docker-compose logs -f`
2. 查看文档: 上面列出的相关文档
3. 检查服务状态: `docker-compose ps`
4. 查看配置: `配置信息汇总.md`

---

## 🚀 准备好了吗？

所有准备工作已完成，现在就开始部署吧！

### 快速开始命令：

```bash
# 1. 配置 DNS（在腾讯云控制台）
# 2. 上传代码
ssh root@43.142.188.252
git clone <你的仓库>
cd <项目目录>

# 3. 部署
chmod +x deploy.sh
./deploy.sh
```

**预计 15-20 分钟后，你的系统就可以上线了！** 🎉

---

**服务器 IP**: 43.142.188.252  
**域名**: sdhaohan.cn, laimiu.sdhaohan.cn, api.sdhaohan.cn  
**管理员**: Laimiu.new@gmail.com / ghzzz123  

**祝你部署顺利！** 🚀✨

